<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>cddeGao🍟</title>
  
  
  <link href="https://codegao.cc/atom.xml" rel="self"/>
  
  <link href="https://codegao.cc/"/>
  <updated>2023-05-26T05:38:00.608Z</updated>
  <id>https://codegao.cc/</id>
  
  <author>
    <name>cddeGao🍟</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DataX学习与使用笔记</title>
    <link href="https://codegao.cc/posts/80f8c5fb.html"/>
    <id>https://codegao.cc/posts/80f8c5fb.html</id>
    <published>2023-05-17T02:37:00.000Z</published>
    <updated>2023-05-26T05:38:00.608Z</updated>
    
    <content type="html"><![CDATA[<h1>概述</h1><h2 id="什么是DataX">什么是DataX</h2><p>DataX 是阿里巴巴开源的一个异构数据源离线同步工具，致力于实现包括关系型数据<br>库(MySQL、Oracle 等)、HDFS、Hive、ODPS、HBase、FTP 等各种异构数据源之间稳定高<br>效的数据同步功能。</p>]]></content>
    
    
    <summary type="html">DataX学习及遇到的问题记录</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="DataX" scheme="https://codegao.cc/tags/DataX/"/>
    
  </entry>
  
  <entry>
    <title>尚硅谷数据仓库学习笔记(二)</title>
    <link href="https://codegao.cc/posts/42eff9f3.html"/>
    <id>https://codegao.cc/posts/42eff9f3.html</id>
    <published>2023-04-23T02:29:00.000Z</published>
    <updated>2023-05-26T10:09:54.760Z</updated>
    
    <content type="html"><![CDATA[<h2 id="业务介绍">业务介绍</h2>]]></content>
    
    
    <summary type="html">尚硅谷数据仓库学习笔记</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="数据仓库" scheme="https://codegao.cc/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>hive常用命令</title>
    <link href="https://codegao.cc/posts/87c40b54.html"/>
    <id>https://codegao.cc/posts/87c40b54.html</id>
    <published>2023-04-20T07:41:00.000Z</published>
    <updated>2023-04-20T08:03:11.926Z</updated>
    
    <content type="html"><![CDATA[<h3 id="总结hive常用命令">总结hive常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以shll方式执行hive命令</span></span><br><span class="line">hive -e &quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行含有shell命令的脚本</span></span><br><span class="line">hive -f xx.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">清空表中的数据</span></span><br><span class="line">truncate table db.table</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件中数据导入到hive</span></span><br><span class="line">load data inpath &#x27;/user/hive/tmp1.csv&#x27; into table db.table</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件中数据导入到hive(覆盖)</span></span><br><span class="line">load data inpath &#x27;/user/hive/tmp1.csv&#x27; OVERWRITE into table db.table</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">hive用到的命令</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="hive" scheme="https://codegao.cc/tags/hive/"/>
    
  </entry>
  
  <entry>
    <title>java执行shell命令无法使用管道符</title>
    <link href="https://codegao.cc/posts/474787d7.html"/>
    <id>https://codegao.cc/posts/474787d7.html</id>
    <published>2023-04-07T05:21:41.000Z</published>
    <updated>2023-04-07T05:32:41.994Z</updated>
    
    <content type="html"><![CDATA[<p>最近遇到了一个问题，java通过Runtime exec()执行shell命令无法使用grep。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rt.exec(<span class="string">&quot;top -b -n 1 | grep top&quot;</span>)</span><br></pre></td></tr></table></figure><p>这样是无法执行的</p><p>改为:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] command = &#123; <span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;top -b -n 1 | grep top&quot;</span>&#125;;</span><br></pre></td></tr></table></figure><p>这样就可以了</p>]]></content>
    
    
    <summary type="html">java执行shell命令无法使用grep管道符</summary>
    
    
    
    <category term="Java" scheme="https://codegao.cc/categories/Java/"/>
    
    
    <category term="Java" scheme="https://codegao.cc/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu安装及常用命令</title>
    <link href="https://codegao.cc/posts/3178680b.html"/>
    <id>https://codegao.cc/posts/3178680b.html</id>
    <published>2023-03-21T09:42:00.000Z</published>
    <updated>2023-03-22T05:44:25.016Z</updated>
    
    <content type="html"><![CDATA[<h2 id="环境说明">环境说明</h2><h3 id="磁盘分区">磁盘分区</h3><p>首先要知道你电脑的磁盘分区是GPT还是MBR的，分区可以决定你用哪种方式安装系统，以及安装什么版本的系统。<br><strong>Windos查看磁盘分区</strong><br>我的电脑-&gt;管理-&gt;磁盘管理<br>然后选中 磁盘0 右键属性<br>选择卷，就可以查看磁盘分区了</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/01.jpg"/></div></div><p>一般新电脑都是GPT分区的，老电脑是MBR分区的<br>GPT分区的我们选择ubuntu<br>MBR分区的可以装centos<br>关于GPT和MBR，感兴趣的朋友可以参考这篇文章：<a href="https://zhuanlan.zhihu.com/p/37977078">https://zhuanlan.zhihu.com/p/37977078</a></p><p>如果GPT分区的主板不支持MBR的话，会出现<code>grub&gt;</code>的问题</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/03.jpg"/></div></div><h3 id="下载镜像">下载镜像</h3><p>由于磁盘分区格式限制，我选择最新稳定版本的ubuntu，下载地址：<a href="https://ubuntu.com/download/server">https://ubuntu.com/download/server</a><br>ubuntu有桌面版和命令行版，我下载的是server版本(命令版)</p><h3 id="制作Linux启动盘">制作Linux启动盘</h3><p>启动盘我们使用Rufus来制作<br>下载地址：<a href="https://rufus.ie/zh/">https://rufus.ie/zh/</a><br>下载好后插上U盘，打开Rufus，就可以读到我们的U盘了。<br>选择刚刚下载的镜像，以及适配电脑的分区类型和文件系统</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/02.jpg"/></div></div><p>点击开始，等待制作即可。</p><h2 id="安装ubuntu">安装ubuntu</h2><p>插上制作好的U盘，进入Bios<br>设置U盘启动</p><p>语言和键盘设置默认就可以</p><h3 id="网络配置">网络配置</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/04.png"/></div></div><p>这个步骤可以选择DHCP获取IP，有利于新手快速学习，如果有IP知识，也可以按tab键配置IP相关 地址，如上图中标记。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/05.png"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/06.png"/></div></div><p>配置的固定ip地址如上图所示，地址段根据vm默认即可，DNS为公共可用DNS。</p><h3 id="其他配置">其他配置</h3><p>代理、源都可以安装好后再配置<br>磁盘分区可以选择默认的</p><h3 id="系统信息">系统信息</h3><p>配置系统主机名、登录用户和密码。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/07.png"/></div></div><h3 id="ssh工具">ssh工具</h3><p>按空格键勾选图中的小方框内为小叉子，然后按tab键选择Done继续。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/08.png"/></div></div><p>然后就安装完成啦！</p><h2 id="ubuntu常用配置">ubuntu常用配置</h2><h3 id="root用户管理">root用户管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">切换root用户</span></span><br><span class="line">sudo su</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改root密码</span></span><br><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure><h3 id="ssh配置">ssh配置</h3><p>默认Ubuntu不允许root远程登录，后期如果想通过root登陆系统则必须修改SSH配置文件中的相关参数 才行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改ssh配置</span></span><br><span class="line">sudo vim /etc/ssh/sshd_config PermitRootLogin yes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启sshd进程</span></span><br><span class="line">sudo systemctl restart sshd</span><br></pre></td></tr></table></figure><h3 id="配置apt源">配置apt源</h3><p>ubuntu下的软件源可以在阿里源或者清华源上找到相应的配置方法:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/apt/sources.list</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新缓存</span></span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h3 id="关闭休眠">关闭休眠</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改配置文件</span></span><br><span class="line">vim /etc/systemd/logind.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改内容：</span></span><br><span class="line">HandleLidSwitch=ignore</span><br><span class="line">HandleLidSwitchExternalPower=ignore</span><br><span class="line">HandleLidSwitchDocked=ignore</span><br></pre></td></tr></table></figure><h3 id="关闭防火墙">关闭防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看防火墙状态</span></span><br><span class="line">sudo ufw status</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭防火墙</span></span><br><span class="line">sudo ufw disable</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启防火墙</span></span><br><span class="line">sudo ufw enable</span><br></pre></td></tr></table></figure><h3 id="配置静态ip">配置静态ip</h3><p>ubuntu22的网络配置统一在/etc/netplan/下管理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/netplan/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备份</span></span><br><span class="line">sudo cp 01-network-manager-all.yaml 01-network-manager-all.yaml.bak</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##修改内容</span></span></span><br><span class="line">vim 01-network-manager-all.yaml</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/ubuntu安装及常用命令/09.jpg"/></div></div><p>最后，让配置生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure><p>如果不知道网络参数可以使用下面的命令查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看ip、子网掩码</span></span><br><span class="line">ip -a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看网关</span></span><br><span class="line">route -n</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看dns</span></span><br><span class="line">resolvectl status</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">物理机安装ubuntu的配置及常用命令</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="ubuntu" scheme="https://codegao.cc/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>Login-shell与NoLogin-shell区别</title>
    <link href="https://codegao.cc/posts/5988758c.html"/>
    <id>https://codegao.cc/posts/5988758c.html</id>
    <published>2023-03-15T03:05:00.000Z</published>
    <updated>2023-03-15T03:17:04.852Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Linux环境变量配置说明">Linux环境变量配置说明</h3><p>Linux的环境变量可以在多个文件中配置，如/etc/profile，/etc/profile.d/*.sh，~/.bashrc，~/.bash_profile等，下面说以下上述几个文件之间的关系和区别。</p><p>bash的运行模式可分为<strong>login shell</strong>和<strong>non-login shell</strong>。</p><p>例如，我们通过终端，<strong>输入用户名、密码</strong>，登录系统之后，得到就是一个login shell。而当我们执行以下命令ssh 命令的时候，就是一个non-login shell。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Login-shell与NoLogin-shell区别/1.jpg"/></div></div><p>这两种shell的区别在于，它们启动时会加载不同的配置文件，<strong>login shell</strong>启动时会加载<code>/etc/profile，~/.bash_profile，~/.bashrc</code>。<strong>non-login shell</strong>启动时会加载<code>~/.bashrc</code>。<br>而在加载<code>~/.bashrc</code>或<code>/etc/profile</code>时，都会执行如下代码片段：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Login-shell与NoLogin-shell区别/2.jpg"/></div></div><p>因此不管是login shell还是non-login shell，启动时都会加载/etc/profile.d/*.sh中的环境变量。</p>]]></content>
    
    
    <summary type="html">Linux中Login-shell与NoLogin-shell区别</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="Linux" scheme="https://codegao.cc/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux忘记root密码</title>
    <link href="https://codegao.cc/posts/a4c14829.html"/>
    <id>https://codegao.cc/posts/a4c14829.html</id>
    <published>2023-03-15T02:32:00.000Z</published>
    <updated>2023-03-15T02:55:41.631Z</updated>
    
    <content type="html"><![CDATA[<p>①重启服务器，按<code>e</code>进入编辑模式</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Linux忘记root密码/1.jpg"/></div></div><p>②在linux16这行的末尾添加<code>init=/bin/sh</code></p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Linux忘记root密码/2.jpg"/></div></div><p>③然后按<code>Ctrl+X</code>进入单用户模式</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Linux忘记root密码/3.jpg"/></div></div><p>④输入<code>mount -o remount,rw /</code>，输入完成后按回车</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Linux忘记root密码/4.jpg"/></div></div><p>⑤再输入passwd并回车，接下来输入密码，确认密码即可</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Linux忘记root密码/5.jpg"/></div></div><p>⑥接下来输入<code>touch /.autorelabel</code></p><p>⑦再继续输入<code>exec /sbin/init</code>等待重启即可</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Linux忘记root密码/6.jpg"/></div></div>]]></content>
    
    
    <summary type="html">Linux忘记root密码的解决方案</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="Linux" scheme="https://codegao.cc/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>尚硅谷数据仓库学习笔记(一)</title>
    <link href="https://codegao.cc/posts/edde6291.html"/>
    <id>https://codegao.cc/posts/edde6291.html</id>
    <published>2023-03-03T07:29:00.000Z</published>
    <updated>2023-04-24T11:02:45.531Z</updated>
    
    <content type="html"><![CDATA[<p>个人跟着尚硅谷数仓项目做的笔记，仅供学习使用.</p><h2 id="数据仓库">数据仓库</h2><h3 id="数据仓库概念">数据仓库概念</h3><p><strong>数据仓库(Data Warehouse)</strong>：是为企业制定决策，提供数据支持的。可以帮助企业改进业务流程、提高产品质量等。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230303161105491.png"/></div></div><p><strong>ODS</strong>：数据备份，原封不动地把输入的数据存放起来</p><p><strong>DWD</strong>：主要做数据清洗</p><p><strong>DWS</strong>：预聚合，避免大表重复join，消耗性能和资源</p><p><strong>ADS</strong>：存放最终的指标，并输出到各个系统中</p><p>数据仓库并不是数据的最终目的地，二十为数据最终的目的地做好准备。这些准备包括对数据的：<strong>备份、清洗、聚合、统计</strong>等。</p><h3 id="数据仓库需求">数据仓库需求</h3><h4 id="离线需求">离线需求</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230303163500611.png"/></div></div><h4 id="实时需求">实时需求</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230303163618624.png"/></div></div><h4 id="技术选型">技术选型</h4><p>技术选型主要考虑因素：<strong>数据量大小、业务需求、业内经验、技术成熟度、开发维护成本、总成本预算</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230303165245511.png"/></div></div><h3 id="数据流程设计">数据流程设计</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230303174108151.png"/></div></div><h3 id="具体版本号选择">具体版本号选择</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一//image-20230309145644051.png"/></div></div><h2 id="用户行为">用户行为</h2><h3 id="用户行为概述">用户行为概述</h3><p>用户行为日志的内容，主要包括用户的各项<strong>行为信息</strong>以及行为所处的<strong>环境信息</strong>。收集这些信息的主要目的是优化产品和为各项分析统计指标提供数据支撑。收集这些信息的手段通常为<strong>埋点</strong>。</p><p>目前主流的埋点方式，有<strong>代码埋点</strong>（前端/后端）、<strong>可视化埋点</strong>、<strong>全埋点</strong>等。</p><p><strong>代码埋点</strong>是通过调用埋点SDK函数，在需要埋点的业务逻辑功能位置调用接口，上报埋点数据。例如，我们对页面中的某个按钮埋点后，当这个按钮被点击时，可以在这个按钮对应的 OnClick 函数里面调用SDK提供的数据发送接口，来发送数据。</p><p><strong>可视化埋点</strong>只需要研发人员集成采集 SDK，不需要写埋点代码，业务人员就可以通过访问分析平台的“圈选”功能，来“圈”出需要对用户行为进行捕捉的控件，并对该事件进行命名。圈选完毕后，这些配置会同步到各个用户的终端上，由采集 SDK 按照圈选的配置自动进行用户行为数据的采集和发送。</p><p><strong>全埋点</strong>是通过在产品中嵌入SDK，前端自动采集页面上的全部用户行为事件，上报埋点数据，相当于做了一个统一的埋点。然后再通过界面配置哪些数据需要在系统里面进行分析。</p><h3 id="用户行为日志">用户行为日志</h3><p>本项目收集和分析的用户行为信息主要有<strong>页面浏览记录、动作记录、曝光记录、启动记录和错误记录。</strong></p><h4 id="页面浏览记录">页面浏览记录</h4><p>页面浏览记录，记录的是访客对页面的浏览行为，该行为的环境信息主要有用户信息、时间信息、地理位置信息、设备信息、应用信息、渠道信息及页面信息等。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230309163906378.png"/></div></div><h4 id="动作记录">动作记录</h4><p>动作记录，记录的是用户的业务操作行为，该行为的环境信息主要有用户信息、时间信息、地理位置信息、设备信息、应用信息、渠道信息 及动作目标对象信息等。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230309165638179.png"/></div></div><h4 id="曝光记录">曝光记录</h4><p>曝光记录，记录的是曝光行为，该行为的环境信息主要有用户信息、时间信息、地理位置信息、设备信息、应用信息、渠道信息及曝光对象信息等。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230309165733253.png"/></div></div><h4 id="启动记录">启动记录</h4><p>启动记录，记录的是用户启动应用的行为，该行为的环境信息主要有用户信息、时间信息、地理位置信息、设备信息、应用信息、渠道信息、启动类型及开屏广告信息等。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/image-20230309165820049.png"/></div></div><h4 id="错误记录"><strong>错误记录</strong></h4><p>启动记录，记录的是用户在使用应用过程中的报错行为，该行为的环境信息主要有用户信息、时间信息、地理位置信息、设备信息、应用信息、渠道信息、以及可能与报错相关的页面信息、动作信息、曝光信息和动作信息。</p><h2 id="集群软件安装">集群软件安装</h2><h3 id="前提准备">前提准备</h3><p>准备三台机器，并配置好免密登录</p><h3 id="jdk安装">jdk安装</h3><p>把安装包上传到/opt/software下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压到/opt/module/目录下</span></span><br><span class="line">tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入module目录</span></span><br><span class="line">cd /opt/module/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把解压后的名字修改为jdk</span></span><br><span class="line">/opt/module/</span><br></pre></td></tr></table></figure><p>配置环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">新建sudo vim /etc/profile.d/my_env.sh</span></span><br><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br></pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">JAVA_HOME</span></span><br><span class="line">export JAVA_HOME=/opt/module/jdk</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure><p>环境变量生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile.d/my_env.sh</span><br></pre></td></tr></table></figure><p>三台机器都需要安装</p><h3 id="集群查看所有进程脚本">集群查看所有进程脚本</h3><p>在~/bin目录下创建脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim xcall</span><br></pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"> </span><br><span class="line">for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">do</span><br><span class="line">    echo --------- $i ----------</span><br><span class="line">    ssh $i &quot;$*&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>修改执行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 xcall</span><br></pre></td></tr></table></figure><p>启动脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcall jps</span><br></pre></td></tr></table></figure><h3 id="Hadoop部署">Hadoop部署</h3><h4 id="集群规划">集群规划</h4><table><thead><tr><th></th><th>hadoop133</th><th>hadoop134</th><th>hadoop135</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode、DataNode</td><td>DataNode</td><td>SecondaryNameNode、DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager、NodeManager</td><td>NodeManager</td></tr></tbody></table><h4 id="上传安装包">上传安装包</h4><p>将安装包上传到 /opt/software/目录下</p><h4 id="解压">解压</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压到/opt/moudle目录</span></span><br><span class="line">tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重命名</span></span><br><span class="line">mv /opt/module/hadoop-3.1.3 /opt/module/hadoop</span><br></pre></td></tr></table></figure><h4 id="添加环境变量">添加环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">打开/etc/profile.d/my_env.sh文件</span></span><br><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br></pre></td></tr></table></figure><p>追加hadoop路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">HADOOP_HOME</span></span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin</span><br></pre></td></tr></table></figure><p>环境变量生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile.d/my_env.sh</span><br></pre></td></tr></table></figure><h4 id="配置集群">配置集群</h4><h5 id="配置core-site-xml">配置core-site.xml</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $HADOOP_HOME/etc/hadoop</span><br><span class="line">vim core-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定NameNode的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop133:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定hadoop数据的存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置HDFS网页登录使用的静态用户为atguigu --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>atguigu<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置该atguigu(superUser)允许通过代理访问的主机节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.atguigu.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置该atguigu(superUser)允许通过代理用户所属组 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.atguigu.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置该atguigu(superUser)允许通过代理的用户--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.atguigu.users<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="配置hdfs-site-xml">配置hdfs-site.xml</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim hdfs-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- nn web端访问地址--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop133:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- 2nn web端访问地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop135:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 测试环境指定HDFS副本的数量1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="配置yarn-site-xml">配置yarn-site.xml</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim yarn-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定MR走shuffle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定ResourceManager的地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop134<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 环境变量的继承 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--yarn单个容器允许分配的最大最小内存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- yarn容器允许管理的物理内存大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 关闭yarn对物理内存和虚拟内存的限制检查 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="配置mapred-site-xml">配置mapred-site.xml</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mapred-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定MapReduce程序运行在Yarn上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="配置workers">配置workers</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/module/hadoop/etc/hadoop/workers</span><br></pre></td></tr></table></figure><p>添加集群信息</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop133</span><br><span class="line">hadoop134</span><br><span class="line">hadoop135</span><br></pre></td></tr></table></figure><p><strong>注意：该文件中添加的内容结尾不允许有空格，文件中不允许有空行。</strong></p><h5 id="配置历史服务器">配置历史服务器</h5><p>为了查看程序的历史运行情况，需要配置一下历史服务器。具体配置步骤如下：</p><p>配置mapred-site.xml</p><p>增加如下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史服务器端地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop133:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 历史服务器web端地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop133:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="配置日志聚集">配置日志聚集</h5><p>日志聚集概念：应用运行完成以后，将程序运行日志信息上传到HDFS系统上。</p><p>日志聚集功能好处：可以方便的查看到程序运行详情，方便开发调试。</p><p><strong>注意：开启日志聚集功能，需要重新启动NodeManager 、ResourceManager和HistoryManager。</strong></p><p>配置yarn-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启日志聚集功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 设置日志聚集服务器地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://hadoop133:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 设置日志保留时间为7天 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="启动集群">启动集群</h4><p>如果是第一次启动，需要先格式化NameNode（注意格式化之前，一定要先停止上次启动的所有namenode和datanode进程，然后再删除data和log数据）</p><h5 id="格式化NameNode">格式化NameNode</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="variable">$hadoop_home</span>下执行</span></span><br><span class="line">bin/hdfs namenode -format</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/1.jpg"/></div></div><p>出现以上日志表示格式化成功</p><h5 id="启动HDFS">启动HDFS</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-dfs.sh</span><br></pre></td></tr></table></figure><h5 id="启动YARN">启动YARN</h5><p>ResourceManager是部署在hadoop134上面的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-yarn.sh</span><br></pre></td></tr></table></figure><p>我们在各个服务器上查看一下jps</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/2.jpg"/></div></div><p>每个节点都有一个DateNode和NodeManager，然后NameNode、ResourceManager、SecondaryNameNode每个节点一个</p><h4 id="集群脚本">集群脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/bin</span><br><span class="line"></span><br><span class="line">vim hdp.sh</span><br></pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">    echo &quot;No Args Input...&quot;</span><br><span class="line">    exit ;</span><br><span class="line">fi</span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)</span><br><span class="line">        echo &quot; =================== 启动 hadoop集群 ===================&quot;</span><br><span class="line"></span><br><span class="line">        echo &quot; --------------- 启动 hdfs ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/sbin/start-dfs.sh&quot;</span><br><span class="line">        echo &quot; --------------- 启动 yarn ---------------&quot;</span><br><span class="line">        ssh hadoop103 &quot;/opt/module/hadoop/sbin/start-yarn.sh&quot;</span><br><span class="line">        echo &quot; --------------- 启动 historyserver ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/bin/mapred --daemon start historyserver&quot;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)</span><br><span class="line">        echo &quot; =================== 关闭 hadoop集群 ===================&quot;</span><br><span class="line"></span><br><span class="line">        echo &quot; --------------- 关闭 historyserver ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/bin/mapred --daemon stop historyserver&quot;</span><br><span class="line">        echo &quot; --------------- 关闭 yarn ---------------&quot;</span><br><span class="line">        ssh hadoop103 &quot;/opt/module/hadoop/sbin/stop-yarn.sh&quot;</span><br><span class="line">        echo &quot; --------------- 关闭 hdfs ---------------&quot;</span><br><span class="line">        ssh hadoop102 &quot;/opt/module/hadoop/sbin/stop-dfs.sh&quot;</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">    echo &quot;Input Args Error...&quot;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p>修改脚本权限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 hdp.sh</span><br></pre></td></tr></table></figure><h3 id="Zookeper部署">Zookeper部署</h3><h4 id="集群规划-2">集群规划</h4><p>每个节点都部署一个Zookeeper即可</p><h4 id="解压安装">解压安装</h4><p>把安装包上传到/opt/software目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压到/opt/module下</span></span><br><span class="line">tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改名称为zookeeper</span></span><br><span class="line">mv apache-zookeeper-3.5.7-bin/ zookeeper</span><br></pre></td></tr></table></figure><h4 id="配置服务器编号">配置服务器编号</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在zookeeper目录下创建zkData</span></span><br><span class="line">mkdir zkData</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在zkData目录下创建一个myid的文件</span></span><br><span class="line">vim myid</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在文件中添加与server对应的编号：</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure><h4 id="配置zoo-cfg">配置zoo.cfg</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重命名/opt/module/zookeeper-3.5.7/conf这个目录下的zoo_sample.cfg为zoo.cfg</span></span><br><span class="line">mv zoo_sample.cfg zoo.cfg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改zoo.cfg文件</span></span><br><span class="line">vim zoo.cfg</span><br></pre></td></tr></table></figure><p>zoo.cfg修改内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改数据存储路径配置</span></span><br><span class="line">/opt/module/zookeeper/zkData</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">######################cluster##########################</span></span></span><br><span class="line">server.3=hadoop133:2888:3888</span><br><span class="line">server.4=hadoop134:2888:3888</span><br><span class="line">server.5=hadoop135:2888:3888</span><br></pre></td></tr></table></figure><h4 id="集群启停脚本">集群启停脚本</h4><p>在hadoop133机器上创建脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入~/bin</span></span><br><span class="line">cd ~/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建zk.sh</span></span><br><span class="line">vim zk.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加如下内容</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">do</span><br><span class="line">        echo ---------- zookeeper $i 启动 ------------</span><br><span class="line">ssh $i &quot;/opt/module/zookeeper/bin/zkServer.sh start&quot;</span><br><span class="line">done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">do</span><br><span class="line">        echo ---------- zookeeper $i 停止 ------------    </span><br><span class="line">ssh $i &quot;/opt/module/zookeeper/bin/zkServer.sh stop&quot;</span><br><span class="line">done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">do</span><br><span class="line">        echo ---------- zookeeper $i 状态 ------------    </span><br><span class="line">ssh $i &quot;/opt/module/zookeeper/bin/zkServer.sh status&quot;</span><br><span class="line">done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">增加脚本执行权限</span></span><br><span class="line">chmod 777 zk.sh</span><br></pre></td></tr></table></figure><h3 id="Kafka部署">Kafka部署</h3><h4 id="集群规划-3">集群规划</h4><p>每个节点一个即可</p><h4 id="解压安装-2">解压安装</h4><p>把安装包上传到/opt/software目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压到/opt/module</span></span><br><span class="line">tar -zxvf kafka_2.12-3.0.0.tgz -C /opt/module/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重命名</span></span><br><span class="line">mv kafka_2.12-3.0.0/ kafka</span><br></pre></td></tr></table></figure><h4 id="修改配置">修改配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入kafka目录</span></span><br><span class="line">cd config/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改server.properties文件</span></span><br><span class="line">vim server.properties</span><br></pre></td></tr></table></figure><p>修改内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">broker.id=0</span><br><span class="line">log.dirs=/opt/module/kafka/datas</span><br><span class="line">zookeeper.connect=hadoop133:2181,hadoop134:2181,hadoop135:2181/kafka</span><br></pre></td></tr></table></figure><h4 id="配置环境变量">配置环境变量</h4><p>在/etc/profile.d/my_env.sh文件中增加kafka环境变量配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">增加如下内容</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">KAFKA_HOME</span></span><br><span class="line">export KAFKA_HOME=/opt/module/kafka</span><br><span class="line">export PATH=$PATH:$KAFKA_HOME/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后应用生效</span></span><br><span class="line">source /etc/profile.d/my_env.sh</span><br></pre></td></tr></table></figure><h4 id="集群启停脚本-2">集群启停脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cd ~/bin</span><br><span class="line"></span><br><span class="line">vim kf.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">脚本如下：</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">    for i in hadoop133 hadoop134 hadoop135</span><br><span class="line">    do</span><br><span class="line">        echo &quot; --------启动 $i Kafka-------&quot;</span><br><span class="line">        ssh $i &quot;/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties&quot;</span><br><span class="line">    done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">    for i in hadoop133 hadoop134 hadoop135</span><br><span class="line">    do</span><br><span class="line">        echo &quot; --------停止 $i Kafka-------&quot;</span><br><span class="line">        ssh $i &quot;/opt/module/kafka/bin/kafka-server-stop.sh &quot;</span><br><span class="line">    done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加执行权限</span></span><br><span class="line">chmod +x kf.sh</span><br></pre></td></tr></table></figure><h3 id="Flume部署">Flume部署</h3><h4 id="解压安装-3">解压安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压</span></span><br><span class="line">tar -zxf /opt/software/apache-flume-1.9.0-bin.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改名称</span></span><br><span class="line">mv /opt/module/apache-flume-1.9.0-bin /opt/module/flume</span><br></pre></td></tr></table></figure><h4 id="解决jar包冲突">解决jar包冲突</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /opt/module/flume/lib/guava-11.0.2.jar</span><br></pre></td></tr></table></figure><h3 id="日志采集Flume">日志采集Flume</h3><p>按照规划，需要采集的用户行为日志文件分布在hadoop102，hadoop103两台日志服务器，故需要在hadoop102，hadoop103两台节点配置日志采集Flume。日志采集Flume需要采集日志文件内容，并对日志格式（JSON）进行校验，然后将校验通过的日志发送到Kafka。<br>此处可以选择TailDirSource和KafkaChannel，并配置日志校验拦截器。<br>选择TailSource和KafkaChannel的原因如下：</p><p><strong>①TailDirSource</strong><br>TailDirSource相比ExecSource、SpoolingDirectorySource的优势</p><blockquote><p>TailDirSource：断电续传、多目录。Flume1.6以前需要自己定义Source记录每次读取文件位置，实现断点续传。</p><p>EXECSource：可以实时搜集数据，但是再Flume不运行或者Shell命令出错的情况下，数据会丢失</p><p>SpoolingDirectorySource：监控目录，支持断点续传</p></blockquote><p><strong>②KafkaChannel</strong></p><p>采用KafkaChannel，省去了Sink，提高了效率</p><p>日志采集Flume配置：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/3.jpg"/></div></div><h4 id="日志采集配置实操">日志采集配置实操</h4><p><strong>①创建Flume配置文件</strong></p><p>在flume目录下创建job文件夹，并创建配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir job</span><br><span class="line"></span><br><span class="line">vim job/file_to_kafka.conf</span><br></pre></td></tr></table></figure><p><strong>②配置文件内容如下：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#定义组件</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#配置source</span><br><span class="line">a1.sources.r1.type = TAILDIR</span><br><span class="line">a1.sources.r1.filegroups = f1</span><br><span class="line">a1.sources.r1.filegroups.f1 = /opt/module/applog/log/app.*</span><br><span class="line">a1.sources.r1.positionFile = /opt/module/flume/taildir_position.json</span><br><span class="line">a1.sources.r1.interceptors =  i1</span><br><span class="line">a1.sources.r1.interceptors.i1.type = com.atguigu.gmall.flume.interceptor.ETLInterceptor$Builder</span><br><span class="line"></span><br><span class="line">#配置channel</span><br><span class="line">a1.channels.c1.type = org.apache.flume.channel.kafka.KafkaChannel</span><br><span class="line">a1.channels.c1.kafka.bootstrap.servers=hadoop102:9092,hadoop103:9092</span><br><span class="line">a1.channels.c1.kafka.topic = topic_log</span><br><span class="line">a1.channels.c1.parseAsFlumeEvent = false</span><br><span class="line"></span><br><span class="line">#组装 </span><br><span class="line">a1.sources.r1.channels = c1</span><br></pre></td></tr></table></figure><p><strong>③编写Flume拦截器</strong></p><p>pom依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-ng-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>④JSONUtil类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gmall.flume.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JSONUtil</span> &#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 通过异常判断是否是json字符串</span></span><br><span class="line"><span class="comment">* 是：返回true  不是：返回false</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isJSONValidate</span><span class="params">(String log)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JSONObject.parseObject(log);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JSONException e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>⑤ETLInterceptor类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gmall.flume.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.gmall.flume.utils.JSONUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.Event;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ETLInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Event <span class="title function_">intercept</span><span class="params">(Event event)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1、获取body当中的数据并转成字符串</span></span><br><span class="line">        <span class="type">byte</span>[] body = event.getBody();</span><br><span class="line">        <span class="type">String</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body, StandardCharsets.UTF_8);</span><br><span class="line"><span class="comment">//2、判断字符串是否是一个合法的json，是：返回当前event；不是：返回null</span></span><br><span class="line">        <span class="keyword">if</span> (JSONUtil.isJSONValidate(log)) &#123;</span><br><span class="line">            <span class="keyword">return</span> event;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Event&gt; <span class="title function_">intercept</span><span class="params">(List&lt;Event&gt; list)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Iterator&lt;Event&gt; iterator = list.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">Event</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="keyword">if</span>(intercept(next)==<span class="literal">null</span>)&#123;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span>.Builder&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Interceptor <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ETLInterceptor</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Context context)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>⑥打包</strong><br>将打好的包放到flume/lib文件夹下面</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/尚硅谷数据仓库学习笔记一/4jpg"/></div></div><h4 id="日志采集测试">日志采集测试</h4><p><strong>①启动Flume</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf/ -f job/file_to_kafka.conf -Dflume.root.logger=info,console</span><br></pre></td></tr></table></figure><p><strong>②启动KafkaConsumer</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server hadoop133:9092 --topic topic_log</span><br></pre></td></tr></table></figure><h4 id="Flume启停脚本">Flume启停脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103</span><br><span class="line">        do</span><br><span class="line">                echo &quot; --------启动 $i 采集flume-------&quot;</span><br><span class="line">                ssh $i &quot;nohup /opt/module/flume/bin/flume-ng agent -n a1 -c /opt/module/flume/conf/ -f /opt/module/flume/job/file_to_kafka.conf &gt;/dev/null 2&gt;&amp;1 &amp;&quot;</span><br><span class="line">        done</span><br><span class="line">&#125;;; </span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103</span><br><span class="line">        do</span><br><span class="line">                echo &quot; --------停止 $i 采集flume-------&quot;</span><br><span class="line">                ssh $i &quot;ps -ef | grep file_to_kafka | grep -v grep |awk  &#x27;&#123;print \$2&#125;&#x27; | xargs -n1 kill -9 &quot;</span><br><span class="line">        done</span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">增加脚本执行权限</span></span><br><span class="line">chmod 777 f1.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">尚硅谷数据仓库学习笔记</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="数据仓库" scheme="https://codegao.cc/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>Centos连接Wifi</title>
    <link href="https://codegao.cc/posts/f9433905.html"/>
    <id>https://codegao.cc/posts/f9433905.html</id>
    <published>2023-02-22T05:47:00.000Z</published>
    <updated>2023-03-22T05:42:07.730Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境">环境</h3><p>Linux版本为Centos7.8</p><h3 id="查看网卡状态">查看网卡状态</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看网卡状态</span></span><br><span class="line">ip addr</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Centos连接Wifi/image-20230302135748316.png"/></div></div><p>如果没有出现 UP 说明你的网卡没有激活</p><h3 id="激活网卡">激活网卡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set 网卡名称 up</span><br></pre></td></tr></table></figure><p>例如，我上面要激活wlp4s0 这个网卡</p><p>那我的命令就是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set wlp4s0 up</span><br></pre></td></tr></table></figure><p>一定要看到UP才算激活成功！</p><h3 id="连接Wifi">连接Wifi</h3><p>由于我们现在的wifi是使用WPA和WPA2加密的，因此我们需要使用wpa_supplicant来连接。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成wpa_passphrase配置文件</span></span><br><span class="line">wpa_passphrase wifiName password &gt; /etc/wpa_supplicant.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">连接Wifi</span></span><br><span class="line">/usr/sbin/wpa_supplicant -B -Dwext -iwlp4s0 -c/etc/wpa_supplicant.conf</span><br></pre></td></tr></table></figure><h3 id="分配IP">分配IP</h3><p>连接好Wifi之后并不能访问网络，因为还没有分配ip，所以需要我们手动分配ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dhclient 网卡名称 &amp;</span><br></pre></td></tr></table></figure><h3 id="固定IP">固定IP</h3><p>如果要使用固定IP就不能用dhclient命令了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定ip和子网掩码</span></span><br><span class="line">ifconfig $networkCardName ip netmask 子网掩码</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定网关</span></span><br><span class="line">route add default gw 网关地址</span><br></pre></td></tr></table></figure><p>如果不知道网关等的信息可以先查看dhclient分配的网络信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /var/lib/dhclient/dhclient.leases </span><br></pre></td></tr></table></figure><p>经过以上步骤我们就可以联网啦！</p><h3 id="添加开机自启动脚本">添加开机自启动脚本</h3><p>自启动脚本也有很多种方式添加，我这里采用init.d的方式</p><p>首先需要创建脚本：<a href="http://wifiBoot.sh">wifiBoot.sh</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">chkconfig: 2345 80 90</span></span><br><span class="line">    #description:auto_run</span><br><span class="line">networkCardName=&#x27;wlp4s0&#x27;</span><br><span class="line">wifiName=&#x27;wifiName&#x27;</span><br><span class="line">wifiPassword=&#x27;password&#x27;</span><br><span class="line"></span><br><span class="line">ip link set $wifiname up</span><br><span class="line"></span><br><span class="line">sleep 1 </span><br><span class="line"></span><br><span class="line">wpa_passphrase $wifiName $wifiPassword &gt; /etc/wpa_supplicant.conf</span><br><span class="line"></span><br><span class="line">/usr/sbin/wpa_supplicant -B -Dwext -i$networkCardName -c/etc/wpa_supplicant.conf &amp;</span><br><span class="line"></span><br><span class="line">sleep 3 </span><br><span class="line"></span><br><span class="line">dhclient $networkCardName &amp;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>添加到自启动项</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">脚本移动到init.d目录下</span></span><br><span class="line">mv  /opt/wifiBoot.sh /etc/rc.d/init.d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改权限</span></span><br><span class="line">chmod +x  /etc/rc.d/init.d/wifiBoot.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入init.d目录</span></span><br><span class="line">cd /etc/rc.d/init.d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">加入启动管理列表</span></span><br><span class="line">chkconfig --add wifiBoot.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开机自启动</span></span><br><span class="line">chkconfig wifiBoot.sh on</span><br></pre></td></tr></table></figure><h3 id="添加启动项报错：服务不支持-chkconfig">添加启动项报错：服务不支持 chkconfig</h3><p>脚本开头要添加这三行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">chkconfig: 2345 80 90</span></span><br><span class="line">    #description:auto_run</span><br></pre></td></tr></table></figure><p>第一行，告诉系统使用的shell脚本</p><p>第 二行，chkconfig后面有三个参数2345,80和90告诉chkconfig程序，需要在rc2.d~rc5.d目录下，创建名字为 S80auto_run的文件连接，连接到/etc/rc.d/init.d目录下的的auto_run脚本</p>]]></content>
    
    
    <summary type="html">Centos7连接Wifi并配置开机启动</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="Linux" scheme="https://codegao.cc/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Centos7安装wireless-tools</title>
    <link href="https://codegao.cc/posts/62e5e3bd.html"/>
    <id>https://codegao.cc/posts/62e5e3bd.html</id>
    <published>2023-02-20T05:33:00.000Z</published>
    <updated>2023-03-13T06:18:39.747Z</updated>
    
    <content type="html"><![CDATA[<p>Linux系统默认没有无线网络工具包wireless-tools，root下yum install wireless-tools，显示没有此安装包，后来发现只能手动安装。</p><p>下载地址：<a href="https://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html">https://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html</a></p><h4 id="依赖准备">依赖准备</h4><p>wireless-tools需要make和gcc，没有的需要先安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install make gcc automake</span><br></pre></td></tr></table></figure><h4 id="安装">安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">先解压</span></span><br><span class="line">tar -xzvf wireless-tools.29.tar.gz</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>安装好后提示：</p><p><code>Don't forget to add /usr/local/lib/ to /etc/ld.so.conf, and run ldconfig as root.</code></p><p>我们需要将/usr/local/lib/添加到/etc/ld.so.conf文件下，然后root下ldconfig运行一下就可以了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/usr/local/lib&quot; &gt;&gt; /etc/ld.so.conf</span><br><span class="line"></span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">wireless-tools在Linux下的安装</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="Linux" scheme="https://codegao.cc/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>hive整合iceberg</title>
    <link href="https://codegao.cc/posts/ca5a12a0.html"/>
    <id>https://codegao.cc/posts/ca5a12a0.html</id>
    <published>2023-02-20T05:33:00.000Z</published>
    <updated>2023-03-13T06:34:59.813Z</updated>
    
    <content type="html"><![CDATA[<h3 id="在Hive中添加iceberg的jar包">在Hive中添加iceberg的jar包</h3><p>需要两个jar包<code>iceberg-hive-runtime-1.1.0.jar</code>和<code>libfb303-0.9.3.jar</code></p><p>在apache官网可以下载到<code>iceberg-hive-runtime-1.1.0.jar</code>：<a href="https://iceberg.apache.org/releases/">https://iceberg.apache.org/releases/</a></p><p>在中央仓库可以下载到<code>libfb303-0.9.3.jar</code>：<a href="https://repo1.maven.org/maven2/org/apache/thrift/libfb303/0.9.3/">https://repo1.maven.org/maven2/org/apache/thrift/libfb303/0.9.3/</a></p><p>下载好后添加到服务器上的<code>&#123;HIVE_HOME&#125;/lib</code>下</p><h3 id="修改配置">修改配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#123;HIVE_HOME&#125;/conf/hive-site.xml</span><br></pre></td></tr></table></figure><p>添加如下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>iceberg.engine.hive.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后启动hive就可以了</p><h3 id="hive操作iceberg表">hive操作iceberg表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_iceberg_tbl(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name string,</span><br><span class="line">age <span class="type">int</span></span><br><span class="line">) partitioned <span class="keyword">by</span> (dt string)</span><br><span class="line">stored <span class="keyword">by</span> <span class="string">&#x27;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#x27;</span>;</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/hive整合iceberg/image-20230217142314070.png"/></div></div><p>出现OK，说明创建成功</p><h3 id="添加jar包">添加jar包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add jar /opt/cloudera/parcels/CDH/lib/hive/lib/iceberg-hive-runtime-1.1.0.jar;</span><br><span class="line">add jar /opt/cloudera/parcels/CDH/lib/hive/lib/libfb303-0.9.3.jar;</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/hive整合iceberg/image-20230217143338230.png"/></div></div><p>添加成功！</p><h3 id="插入数据">插入数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into test_iceberg_tbl values(1,&#x27;zhangsan&#x27;,18,&#x27;20230217&#x27;);</span><br></pre></td></tr></table></figure><p>然后在HDFS上可以看到我们刚刚创建的表</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/hive整合iceberg/image-20230217143705481.png"/></div></div><h3 id="查询数据">查询数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test_iceberg_tbl;</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/hive整合iceberg/image-20230217143834934.png"/></div></div><p>可以看到我没刚刚插入的数据</p><h3 id="使用catelog创建表">使用catelog创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> iceberg.catalog.another_hive.type<span class="operator">=</span>hive;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_iceberg_tbl2(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name string,</span><br><span class="line">age <span class="type">int</span></span><br><span class="line">) partitioned <span class="keyword">by</span> (dt string)</span><br><span class="line">stored <span class="keyword">by</span> <span class="string">&#x27;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#x27;</span></span><br><span class="line">tblproperties(<span class="string">&#x27;iceberg.catelog&#x27;</span><span class="operator">=</span><span class="string">&#x27;another_hive&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="插入数据-2">插入数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_iceberg_tbl2 <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;20230217&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">hive集成iceberg</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="hive" scheme="https://codegao.cc/tags/hive/"/>
    
    <category term="iceberg" scheme="https://codegao.cc/tags/iceberg/"/>
    
  </entry>
  
  <entry>
    <title>kylin4.0在CDH6.2.0部署</title>
    <link href="https://codegao.cc/posts/3c214807.html"/>
    <id>https://codegao.cc/posts/3c214807.html</id>
    <published>2023-02-15T03:30:00.000Z</published>
    <updated>2023-03-13T07:37:15.461Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Kylin下载">Kylin下载</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/kylin4.0在CDH6.2.0部署/image-20230216090655196.png"/></div></div><p>根据需要的软件版本下载Kylin</p><p>下载地址：<a href="https://archive.apache.org/dist/kylin/">https://archive.apache.org/dist/kylin/</a></p><h3 id="环境准备">环境准备</h3><p>由于我要在CDH上部署，根据官方文档还需要三个jar包</p><p>官方文档：<a href="https://cwiki.apache.org/confluence/display/KYLIN/Deploy+Kylin+4+on+CDH+6">https://cwiki.apache.org/confluence/display/KYLIN/Deploy+Kylin+4+on+CDH+6</a></p><p>需要的jar包：commons-configuration、hive-exec、stax2-api在官方文档中也有下载连接</p><h3 id="把jar包放到指定目录">把jar包放到指定目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> <span class="variable">$KYLIN_HOME</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p bin/hadoop3_jars/cdh6</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> commons-configuration-1.10.jar bin/hadoop3_jars/cdh6</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> hive-exec-1.21.2.3.1.0.0-78.jar bin/hadoop3_jars/cdh6</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> stax2-api-3.1.4.jar bin/hadoop3_jars/cdh6</span></span><br></pre></td></tr></table></figure><h3 id="准备mysql连接">准备mysql连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> ext</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> mysql-connector-java-5.1.40.jar ext/</span></span><br></pre></td></tr></table></figure><h3 id="修改配置">修改配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi conf/kylin.properties</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">spark配置</span></span><br><span class="line">kylin.query.spark-conf.spark.sql.hive.metastore.version=2.1.1</span><br><span class="line">kylin.query.spark-conf.spark.sql.hive.metastore.jars=/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hive/lib/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop/lib/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop-hdfs/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop-yarn/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop-mapreduce/*</span><br><span class="line">kylin.engine.spark-conf.spark.sql.hive.metastore.version=2.1.1</span><br><span class="line">kylin.engine.spark-conf.spark.sql.hive.metastore.jars=/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hive/lib/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop/lib/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop-hdfs/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop-yarn/*:/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/hadoop-mapreduce/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mysql配置</span></span><br><span class="line">kylin.metadata.url=kylin_metadata@jdbc,driverClassName=com.mysql.jdbc.Driver,url=jdbc:mysql://localhost:3306/kylin_test,username=,password=</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">zk配置</span></span><br><span class="line">kylin.env.zookeeper-connect-string=ip</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="启动">启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sh bin/kylin.sh start</span></span><br></pre></td></tr></table></figure><h3 id="停止">停止</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sh bin/kylin.sh stop</span></span><br></pre></td></tr></table></figure><h3 id="遇到的问题">遇到的问题</h3><h4 id="1-Permission-denied-user-root-access-WRITE-inode-“-“-hdfs-supergroup-drwxr-xr-x">1.Permission denied: user=root, access=WRITE, inode=“/“:hdfs:supergroup:drwxr-xr-x</h4><p>权限不足，需要在hdfs中配置dfs.permissions.enabled，值为false</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/kylin4.0在CDH6.2.0部署/c6b23c30fa3d49b6a84eea533d22e1f2.png"/></div></div><p>然后重启</p><h4 id="2-spark-not-found-set-SPARK-HOME-or-run-bin-download-spark-sh">2.spark not found, set SPARK_HOME, or run bin/download-spark.sh</h4><p>在/etc/profile中加入环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export SPARK_HOME=/opt/cloudera/parcels/CDH/lib/spark</span><br><span class="line">export KYLIN_HOME=/opt/apache-kylin-4.0.0-bin-spark2</span><br><span class="line">export PATH=$KYLIN_HOME/bin:$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><h4 id="3-Caused-by-java-lang-NoSuchFieldError-METASTORE-CLIENT-FILTER-ENABLED">3. Caused by: java.lang.NoSuchFieldError: METASTORE_CLIENT_FILTER_ENABLED</h4><p>原因：hive连接jar包与hive版本不一致</p><p>解决方案：到hive中把连接jar包copy到kylin中</p>]]></content>
    
    
    <summary type="html">kylin安装步骤</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="kylin" scheme="https://codegao.cc/tags/kylin/"/>
    
  </entry>
  
  <entry>
    <title>CDH6.2集群搭建</title>
    <link href="https://codegao.cc/posts/cdc81c6.html"/>
    <id>https://codegao.cc/posts/cdc81c6.html</id>
    <published>2023-02-13T01:30:00.000Z</published>
    <updated>2023-04-25T03:13:14.373Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基础环境配置">基础环境配置</h3><h4 id="配置主机名和网络映射">配置主机名和网络映射</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hostname</span><br><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure><p>确保集群内的节点之间网络通畅</p><h3 id="防火墙与setlinux文件-每个节点都执行">防火墙与setlinux文件(每个节点都执行)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">systemctl disable firewalld.service</span><br><span class="line"></span><br><span class="line">iptables -F</span><br></pre></td></tr></table></figure><p>关闭selinux</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/selinux/config</span><br></pre></td></tr></table></figure><p>将SELINUX=disabled</p><h3 id="配置节点之间SSH免密登录">配置节点之间SSH免密登录</h3><p>在主节点下执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh</span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>将公钥复制到各个节点的~/.ssh/authorized_keys中</p><h3 id="禁用透明大页-每个节点都执行">禁用透明大页(每个节点都执行)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt;&gt; /etc/rc.local  ###为了防止重启机器后，上述配置不生效，将以上内容写入 /etc/rc.local</span><br></pre></td></tr></table></figure><h3 id="禁用交换空间-每个节点都执行">禁用交换空间(每个节点都执行)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;vm.swappiness=0&quot;  &gt;&gt; /etc/sysctl.conf   (永久降低虚拟内存需求率)</span><br><span class="line">sysctl -p                                     (使命令生效) </span><br></pre></td></tr></table></figure><h3 id="安装NTP服务">安装NTP服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载(每个节点都安装)</span></span><br><span class="line">yum install -y ntp</span><br></pre></td></tr></table></figure><p><strong>①配置主节点</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ntp.conf </span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230213173315438.png"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230307144244913.png"/></div></div><p>去掉注释，将地址改成网段地址</p><p>注释掉原有的server，添加以下内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">restrict 172.16.13.133 nomodify notrap nopeer noquery</span><br><span class="line">server 127.127.1.0       ###在实际中可能会出现节点网络连接丢失的情况，这个时候我们可以以本地时间作为时间服务</span><br><span class="line"></span><br><span class="line">fudge  127.127.1.0  stratum  10</span><br></pre></td></tr></table></figure><p><strong>②配置其他从节点</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ntp.conf </span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230307144429307.png"/></div></div><p>需要配置主节点的地址</p><p><strong>③启动ntp服务</strong>(所有节点)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start ntpd.service</span><br><span class="line">systemctl enable ntpd.service</span><br></pre></td></tr></table></figure><p><strong>④验证ntp配置是否成功</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpstat</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230307144733282.png"/></div></div><p>如果出现以上信息说明配置成功</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230307144824073.png"/></div></div><p>如果出现这种情况也是正常的，ntp服务器配置完毕后，需要等待5-10分钟才能与/etc/ntp.conf中配置的标准时间进行同步。</p><h3 id="安装repo-主节点安装">安装repo(主节点安装)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y createrepo</span><br></pre></td></tr></table></figure><h3 id="安装HTTP-主节点安装">安装HTTP(主节点安装)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install httpd         ###就是用的刚配置的cenos7系统源</span><br><span class="line">systemctl start httpd          (启动httpd服务)</span><br><span class="line">systemctl status httpd         (查看httpd服务状态)</span><br><span class="line">systemctl enable httpd         (将httpd服务加入到开启启动项中)</span><br></pre></td></tr></table></figure><p>启动成功后可以浏览<code> http://ip/</code>，如果可以看到以下界面说明是成功的。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230214092021558.png"/></div></div><h3 id="创建yum源-主节点执行">创建yum源(主节点执行)</h3><p>①创建目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir  /var/www/html/cm</span><br></pre></td></tr></table></figure><p>②将rpm安装包放到cm目录下</p><p>③在/var/www/html/cm目录下执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createrepo .  #创建本地yum仓库</span><br></pre></td></tr></table></figure><p>④在/etc/yum.repos.d下面新建cm.repo文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi cm.repo</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Cloudera_Manager]</span><br><span class="line">name=Cloudera Manager</span><br><span class="line">baseurl=http://ip/cm</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure><p>⑤将.repo文件发送到其他节点机器下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/yum.repos.d/cm.repo node2:/etc/yum.repos.d/</span><br><span class="line">scp /etc/yum.repos.d/cm.repo node3:/etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>⑥清空yum缓存(所有节点都执行)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean all   清空缓存信息</span><br><span class="line">yum repolist 查看yum仓库列表</span><br><span class="line">yum makecache 构建yum缓存</span><br></pre></td></tr></table></figure><h3 id="jdk安装及配置-所有节点">jdk安装及配置(所有节点)</h3><h4 id="安装jdk">安装jdk</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install jdk    ###因为var/www/html/cm目录下已经有jdk的rpm包作为yum源，多台服务器可以同时安装</span><br></pre></td></tr></table></figure><p>默认安装路径为/usr/java</p><h4 id="配置jdk">配置jdk</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_181-cloudera</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure><h4 id="配置下发到其他节点">配置下发到其他节点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/profile node2:/etc/</span><br><span class="line">scp /etc/profile node3:/etc/</span><br></pre></td></tr></table></figure><h4 id="配置生效">配置生效</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="安装及配置mysql">安装及配置mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mysql需要安装以下依赖</span></span><br><span class="line">yum -y install libaio perl net-tools</span><br></pre></td></tr></table></figure><p>①将mysql的rpm包上传到主节点上</p><p>②卸载系统自带的mariadb数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mariadb | xargs -I &#123;&#125; rpm -e --nodeps &#123;&#125;</span><br></pre></td></tr></table></figure><p>③安装mysql数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh mysql-community-common-5.7.27-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-libs-5.7.27-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-devel-5.7.27-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-client-5.7.27-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-server-5.7.27-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-libs-compat-5.7.26-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p>④开启数据库服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启数据库服务</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加到自启动服务</span></span><br><span class="line">systemctl enable mysqld</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看状态</span></span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure><p>⑤获取mysql密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br></pre></td></tr></table></figure><p>⑥修改密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p 获取到的密码</span><br><span class="line"></span><br><span class="line">alter user root@localhost identified by &#x27;2wsx#EDC&#x27;; #密码修改为2wsx#EDC</span><br><span class="line"></span><br><span class="line">update user set host = &#x27;%&#x27; where user =&#x27;root&#x27;; #允许远程连接</span><br><span class="line"></span><br><span class="line">flush privileges;#更新</span><br></pre></td></tr></table></figure><p>⑦创建数据库并授权</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p2wsx#EDC -e ‘create database metastore default character set utf8;’</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘hive’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database hive default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on hive.* to ‘hive’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on metastore.* to ‘hive’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘amon’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database amon default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on amon.* to ‘amon’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘rman’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database rman default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on rman.* to ‘rman’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘sentry’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database sentry default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on sentry.* to ‘sentry’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘nav’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database nav default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on nav.* to ‘nav’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘navms’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database navms default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on navms.* to ‘navms’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘cm’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database cm default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on cm.* to ‘cm’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘oos’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database oos default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on oos.* to ‘oos’@‘%’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “create user ‘hue’@‘%’ identified by ‘2wsx#EDC’”;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e ‘create database hue default character set utf8’;</span><br><span class="line"></span><br><span class="line">mysql -u root --password=‘2wsx#EDC’ -e “grant all privileges on hue.* to ‘hue’@‘%’”;</span><br></pre></td></tr></table></figure><p>⑧复制mysql-contannor.jar</p><p>复制mysql-connect到/usr/share/java/,如果没有该文件夹可以自行创建</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp mysql-connector-java-5.1.47.jar /usr/share/java/</span><br></pre></td></tr></table></figure><h3 id="安装CM-server和Agent">安装CM server和Agent</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">主节点安装</span></span><br><span class="line">yum install -y cloudera-manager-daemons cloudera-manager-server   cloudera-manager-agent </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从节点安装</span></span><br><span class="line">yum install -y cloudera-manager-daemons cloudera-manager-agent</span><br></pre></td></tr></table></figure><h3 id="修改agent配置文件">修改agent配置文件</h3><p>分别修改mini1,mini2,mini3agent所在的节点的配置文件config.ini内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/cloudera-scm-agent/config.ini</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server_host=node1 （这里是以node1作为server节点，让agent感知server所在节点）</span></span><br></pre></td></tr></table></figure><h3 id="初始化数据库">初始化数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/cloudera/cm/schema/scm_prepare_database.sh mysql -h localhost -uroot -proot --scm-host localhost scm root root</span><br></pre></td></tr></table></figure><h3 id="上传CDH服务包">上传CDH服务包</h3><p>上传以下三个CHD6大数据服务组件资源包 到【node1】的 /opt/cloudera/parcel-repo 目录下<br>CDH-6.3.0-1.cdh6.3.0.p0.1279813-el7.parcel<br>CDH-6.3.0-1.cdh6.3.0.p0.1279813-el7.parcel.sha<br>manifest.json</p><h3 id="启动Cloudera-Manager">启动Cloudera Manager</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl start cloudera-scm-server      (启动server)</span><br><span class="line">systemctl status cloudera-scm-server     (查看server状态)</span><br><span class="line">systemctl stop cloudera-scm-server         (停止server)</span><br><span class="line">systemctl enable cloudera-scm-server     (开机启动server)</span><br><span class="line">tail -500f /var/log/cloudera-scm-server/cloudera-scm-server.log (查看server启动日志)   </span><br></pre></td></tr></table></figure><p>使用netstat -nltp命令查看【node1】端口7180 是否启动成功，如果出现7180端口，说明启动成功</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230214164813701.png"/></div></div><p>访问ip+7180端口即可查看页面</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230214165002631.png"/></div></div><h3 id="启动Cloudera-Manager-agent-所有节点">启动Cloudera Manager agent(所有节点)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl start cloudera-scm-agent    (启动agent)</span><br><span class="line">systemctl stop cloudera-scm-agent</span><br><span class="line">systemctl enable cloudera-scm-agent   (开机启动agent) </span><br><span class="line">tail -500f /var/log/cloudera-scm-agent/cloudera-scm-agent.log  (查看agent启动日志)    </span><br></pre></td></tr></table></figure><p>如果看到9000和19001端口说明启动成功</p><h3 id="软件安装">软件安装</h3><p>①选择第二个服务组合</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215131136200.png"/></div></div><p>②角色分配</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215111248299.png"/></div></div><p>③数据库设置</p><p>要先通过测试连接才可以继续</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215111404340.png"/></div></div><p>④审核更改</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215132004921.png"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215132031882.png"/></div></div><p>⑤安装</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215133218726.png"/></div></div><h3 id="组件版本">组件版本</h3><table><thead><tr><th style="text-align:center">序号</th><th>组件</th><th>版本</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td>CDH</td><td>6.2.0</td></tr><tr><td style="text-align:center">2</td><td>Hadoop</td><td>3.0.0</td></tr><tr><td style="text-align:center">3</td><td>Hive</td><td>2.1.0</td></tr><tr><td style="text-align:center">4</td><td>Hue</td><td>4.2.0</td></tr><tr><td style="text-align:center">5</td><td>Kafka</td><td>2.1.0</td></tr><tr><td style="text-align:center">6</td><td>Oozie</td><td>5.1.0</td></tr><tr><td style="text-align:center">7</td><td>spark</td><td>2.4.0</td></tr><tr><td style="text-align:center">8</td><td>Sqoop</td><td>1.4.7</td></tr><tr><td style="text-align:center">9</td><td>ZooKeeper</td><td>3.4.5</td></tr><tr><td style="text-align:center">10</td><td>Hbase</td><td>2.1.0</td></tr></tbody></table><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/image-20230215141540031.png"/></div></div><h3 id="主机运行状态不良-Cluster-not-found">主机运行状态不良 / Cluster not found</h3><p>退回上一步，然后执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -f /var/lib/cloudera-scm-agent/cm_guid</span><br><span class="line">systemctl restart cloudera-scm-agent</span><br></pre></td></tr></table></figure><h3 id="fail-to-format-namenode">fail to format namenode</h3><p>清空残留数据，重新初始化</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">手动格式化namenode</span></span><br><span class="line">hdfs namenode -format</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">namenode节点</span></span><br><span class="line">rm -rf /dfs/nn</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">datanode节点</span></span><br><span class="line">rm -rf /dfs/dn</span><br></pre></td></tr></table></figure><h3 id="hadoop报错：Permission-denied-user-root">hadoop报错：Permission denied: user=root</h3><p>1、找到hdfs-site.xml 的 HDFS 服务高级配置代码段（安全阀）<br>2、添加设置如下，保存更改，重启hdfs。</p><p>dfs.permissions.enabled 的值设置为false</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/CDH6.2集群搭建/c6b23c30fa3d49b6a84eea533d22e1f2.png"/></div></div>]]></content>
    
    
    <summary type="html">CDH安装步骤及遇到的问题</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="CDH" scheme="https://codegao.cc/tags/CDH/"/>
    
    <category term="hadoop" scheme="https://codegao.cc/tags/hadoop/"/>
    
  </entry>
  
  <entry>
    <title>hadoop问题</title>
    <link href="https://codegao.cc/posts/41abec6c.html"/>
    <id>https://codegao.cc/posts/41abec6c.html</id>
    <published>2023-01-21T05:33:00.000Z</published>
    <updated>2023-03-15T08:47:06.810Z</updated>
    
    <content type="html"><![CDATA[<p>此文章记录hadoop使用过程中遇到的问题</p><h2 id="hadoop启动后没有datanode">hadoop启动后没有datanode</h2><p><strong>原因</strong>：namenode和datanode的ID不匹配</p><p><strong>解决办法</strong>：</p><p>①根据日志中的路径找到data文件夹</p><p>②将data/current中的VERSION删除</p><p>③重新执行hadoop namenode -format</p><h2 id="HDFS多存储目录">HDFS多存储目录</h2><p>①生产环境服务器磁盘情况</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/hadoop问题/1.jpg"/></div></div><p>②可以在hdfs-site.xml文件中配置多目录，注意新挂载磁盘的访问权限问题。</p><p>HDFS的DateNode节点保存数据的路径由<strong>dfs.datanode.data.dir</strong>参数决定，其默认值为<strong>file://${hadoop.tmp.dir}/dfs/data</strong>，若服务器有多个磁盘，必须对该参数进行修改。如服务器磁盘如上图所示，则该参数应修改为如下的值。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///dfs/data1,file:///hd2/dfs/data2,file:///hd3/dfs/data3,file:///hd4/dfs/data4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意：每台服务器挂载的磁盘不一样，所以每个节点的多目录配置可以不一致。单独配置即可。</p><h2 id="集群数据均衡">集群数据均衡</h2><p>①节点之间数据均衡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启数据均衡</span></span><br><span class="line">start-balancer.sh -threshold 10</span><br></pre></td></tr></table></figure><p>对于参数10，代表的是集群中各个节点的磁盘空间利用率相差不超过10%，可根据实际情况进行调整。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止数据均衡</span></span><br><span class="line">stop-balancer.sh</span><br></pre></td></tr></table></figure><p>②磁盘间数据均衡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成均衡计划（多磁盘下才会生成）</span></span><br><span class="line">hdfs diskbalancer -plan hadoop103</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行均衡计划</span></span><br><span class="line">hdfs diskbalancer -execute hadoop103.plan.json</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看均衡任务执行情况</span></span><br><span class="line">hdfs diskbalancer -query hadoop103</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">取消均衡任务</span></span><br><span class="line">hdfs diskbalancer -cancel hadoop103.plan.json</span><br></pre></td></tr></table></figure><h2 id="hadoop参数调优">hadoop参数调优</h2><p>①HDFS参数调优hdfs-site.xml</p><p>调整NameNode线程池大小，NameNode有一个工作线程池，用来处理不同DataNode的并发心跳以及客户端并发的元数据操作。</p><p>对于大集群或者有大量客户端的集群来说，通常需要增大参数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.handler.count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>②YARN参数调优yarn-site.xml</p><p>调整Yarn单个任务可以申请的最大内存大小，和Hadoop单个节点可用内存大小。调节这两个参数能提高系统内存的利用率。</p><p><strong>yarn.nodemanager.resource.memory-mb</strong></p><p>表示该节点上YARN可使用的物理内存总量，默认是8192（MB），注意，如果你的节点内存资源不够8GB，则需要调减小这个值，而YARN不会智能的探测节点的物理内存总量。</p><p><strong>yarn.scheduler.maximum-allocation-mb</strong></p><p>单个任务可申请的最多物理内存量，默认是8192（MB）。</p>]]></content>
    
    
    <summary type="html">记录hadoop遇到的问题</summary>
    
    
    
    <category term="大数据" scheme="https://codegao.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="hadoop" scheme="https://codegao.cc/tags/hadoop/"/>
    
  </entry>
  
  <entry>
    <title>博客搭建(四)_主题基本设置</title>
    <link href="https://codegao.cc/posts/b039d1dd.html"/>
    <id>https://codegao.cc/posts/b039d1dd.html</id>
    <published>2023-01-05T09:25:28.000Z</published>
    <updated>2023-03-13T02:42:03.450Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-语言">1.语言</h3><p>修改站点配置文件<code>config.yml</code>，默认是en。</p><p>主题支持三种语言：</p><ul><li>default(en)</li><li>zh-CN (简体中文)</li><li>zh-TW (繁体中文)</li></ul><h3 id="2-网站资料">2.网站资料</h3><p>修改网站的信息及个人信息，同样是修改站点配置文件<code>config.yml</code></p><table><thead><tr><th style="text-align:center">参数</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">title</td><td style="text-align:center">网站标题</td></tr><tr><td style="text-align:center">subtitle</td><td style="text-align:center">描述</td></tr><tr><td style="text-align:center">description</td><td style="text-align:center">网站描述</td></tr><tr><td style="text-align:center">keywords</td><td style="text-align:center">网站的关键词。支持多个关键词</td></tr><tr><td style="text-align:center">author</td><td style="text-align:center">您的名字</td></tr><tr><td style="text-align:center">language</td><td style="text-align:center">网站使用的语言。对于简体中文用户来说，使用不同的主题可能需要设置成不同的值，请参考你的主题的文档自行设置，常见的有 zh-Hans和 zh-CN。</td></tr><tr><td style="text-align:center">timezone</td><td style="text-align:center">网站时区。Hexo 默认使用您电脑的时区。请参考 时区列表 进行设置，如 America/New_York, Japan, 和 UTC 。一般的，对于中国大陆地区可以使用 Asia/Shanghai</td></tr></tbody></table><h3 id="3-导航菜单">3.导航菜单</h3><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">首页:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="string">时间轴:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="string">标签:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="string">分类:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-folder-open</span></span><br><span class="line">  <span class="string">清单||fa</span> <span class="attr">fa-heartbeat:</span></span><br><span class="line">    <span class="string">音乐:</span> <span class="string">/music/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-music</span></span><br><span class="line">    <span class="string">照片:</span> <span class="string">/Gallery/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-images</span></span><br><span class="line">    <span class="string">电影:</span> <span class="string">/movies/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-video</span></span><br><span class="line">  <span class="string">友链:</span> <span class="string">/link/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-link</span></span><br><span class="line">  <span class="string">关于:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-heart</span></span><br></pre></td></tr></table></figure><h3 id="4-代码">4.代码</h3><h4 id="4-1-代码高亮">4.1 代码高亮</h4><p>Butterfly支持 6 种代码高亮样式：</p><ul><li>darker</li><li>pale night</li><li>light</li><li>ocean</li><li>mac</li><li>mac light</li></ul><p>修改主题配置文件<code>_config.butterfly.yml</code>。中的<code>highlight_theme</code>属性。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_theme:</span> <span class="string">pale</span> <span class="string">night</span></span><br></pre></td></tr></table></figure><h4 id="4-2-代码复制">4.2 代码复制</h4><p>修改主题配置文件_config.butterfly.yml中的highlight_copy属性，true表示可以复制。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_copy:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="4-3-代码框展开-关闭">4.3 代码框展开/关闭</h4><p>修改主题配置文件<code>_config.butterfly.yml</code>。中的<code>highlight_shrink</code>属性。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_shrink:</span> <span class="literal">true</span> <span class="comment">#代码框不展开，需点击 &#x27;&gt;&#x27; 打开</span></span><br></pre></td></tr></table></figure><p>在默认情况下，代码框自动展开，可设置是否所有代码框都关闭状态，点击&gt;可展开代码。</p><ul><li>true 全部代码框不展开，需点击&gt;打开</li><li>false 代码框展开，有&gt;点击按钮</li><li>none 不显示&gt;按钮</li></ul><h4 id="4-4-代码换行">4.4  代码换行</h4><p>在默认情况下，Hexo 在编译的时候不会实现代码自动换行。如果你不希望在代码块的区域里有横向滚动条的话，那么你可以考虑开启这个功能。</p><p>修改主题配置文件<code>_config.butterfly.yml</code>。中的<code>code_word_wrap</code>属性。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">code_word_wrap:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="4-5-代码高度限制">4.5  代码高度限制</h4><p>可配置代码高度限制，超出的部分会隐藏，并显示展开按钮。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_height_limit:</span> <span class="literal">false</span> <span class="comment"># unit: px</span></span><br></pre></td></tr></table></figure><ol><li>单位是<code>px</code>，直接添加数字，如 200</li><li>实际限制高度为<code>highlight_height_limit + 30 px</code> ，多增加 30px 限制，目的是避免代码高度只超出highlight_height_limit 一点时，出现展开按钮，展开没内容。</li><li>不适用于隐藏后的代码块（ css 设置 <code>display: none</code>）。</li></ol><h3 id="5-社交图标">5 社交图标</h3><p><code>Butterfly</code>支持<a href="https://fontawesome.com/icons?from=io">font-awesome v6</a>图标。</p><p>书写格式：<code>图标名：url || 描述性文字</code>。</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">YML</span></span><br><span class="line"><span class="attribute">social</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">fab fa-github</span><span class="punctuation">:</span> <span class="string">https://github.com/xxxxx || Github</span></span><br><span class="line">  <span class="attribute">fas fa-envelope</span><span class="punctuation">:</span> <span class="string">mailto:xxxxxx@gmail.com || Email</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(四)_主题基本设置/image-20230109165549855.png"/></div></div><h3 id="6-顶部图">6 顶部图</h3><p>如果不要显示顶部图，可直接配置 <code>disable_top_img: true</code>。</p><table><thead><tr><th>配置</th><th>解释</th></tr></thead><tbody><tr><td>index_img</td><td>主页的 top_img</td></tr><tr><td>default_top_img</td><td>默认的 top_img，当页面的 top_img 没有配置时，会显示 default_top_img</td></tr><tr><td>archive_img</td><td>归档页面的 top_img</td></tr><tr><td>tag_img</td><td>tag子页面 的 默认 top_img</td></tr><tr><td>tag_per_img</td><td>tag子页面的 top_img，可配置每个 tag 的 top_img</td></tr><tr><td>category_img</td><td>category 子页面 的 默认 top_img</td></tr><tr><td>category_per_img</td><td>category 子页面的 top_img，可配置每个 category 的 top_img</td></tr></tbody></table><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index_img:</span> <span class="string">xxx.png</span></span><br></pre></td></tr></table></figure><p>其它页面 （tags/categories/自建页面）和文章页的<code>top_img</code>，请到对应的 md 页面设置<code>front-matter</code>中的<code>top_img</code>。</p><h3 id="7-文章置顶与封面">7 文章置顶与封面</h3><p>可以直接在文章的<code>front-matter</code>区域里添加<code>sticky: 1</code>属性来把这篇文章置顶。数值越大，置顶的优先级越大。</p><p>文章的markdown文档上，在<code>Front-matter</code>添加<code>cover</code>，并填上要显示的图片地址。如果不配置<code>cover</code>，可以设置显示默认的<code>cover</code>；如果不想在首页显示cover，可以设置为<code>false</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="comment"># 是否显示文章封面</span></span><br><span class="line">  <span class="attr">index_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">aside_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">archives_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 封面显示的位置</span></span><br><span class="line">  <span class="comment"># 三个值可配置 left , right , both</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">both</span></span><br><span class="line">  <span class="comment"># 当没有设置cover时，默认的封面显示</span></span><br><span class="line">  <span class="attr">default_cover:</span> </span><br></pre></td></tr></table></figure><h3 id="8-文章页相关配置">8 文章页相关配置</h3><h4 id="8-1-文章meta显示">8.1 文章meta显示</h4><p><code>post_meta</code>这个属性用于显示文章的相关信息的，修改主题配置文件<code>_config.butterfly.yml</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">page:</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">both</span> <span class="comment"># created or updated or both 主页文章日期是创建日或者更新日或都显示</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">relative</span> <span class="comment"># date/relative 显示日期还是相对日期</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false 主页是否显示分类</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false 主页是否显示标签</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false 显示描述性文字</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">both</span> <span class="comment"># created or updated or both 文章页日期是创建日或者更新日或都显示</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">relative</span> <span class="comment"># date/relative 显示日期还是相对日期</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false 文章页是否显示分类</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false 文章页是否显示标签</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false 显示描述性文字</span></span><br></pre></td></tr></table></figure><h4 id="8-2-文章版权和协议许可">8.2 文章版权和协议许可</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_copyright:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">decode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">author_href:</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">CC</span> <span class="string">BY-NC-SA</span> <span class="number">4.0</span></span><br><span class="line">  <span class="attr">license_url:</span> <span class="string">https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br></pre></td></tr></table></figure><p>由于<code>Hexo 4.1</code>开始，默认对网址进行解码，以至于如果是中文网址，会被解码，可设置<code>decode: true</code>来显示中文网址。如果有文章（例如：转载文章）不需要显示版权，可以在文章页<code>Front-matter</code>中单独设置。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">copyright:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>从<code>v3.0.0</code>开始，支持对单独文章设置版权信息，可以在文章Front-matter单独设置。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post<span class="emphasis">_copyright:</span></span><br><span class="line"><span class="emphasis">copyright_</span>author: xxxx</span><br><span class="line">copyright<span class="emphasis">_author_</span>href: https://xxxxxx.com</span><br><span class="line">copyright<span class="emphasis">_url: https://xxxxxx.com</span></span><br><span class="line"><span class="emphasis">copyright_</span>info: 此文章版权归xxxxx所有，如有转载，请註明来自原作者</span><br></pre></td></tr></table></figure><h4 id="8-3-文章打赏">8.3 文章打赏</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">QR_code:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/img/wechat.jpg</span></span><br><span class="line">      <span class="attr">link:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">wechat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/img/alipay.jpg</span></span><br><span class="line">      <span class="attr">link:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">alipay</span></span><br></pre></td></tr></table></figure><h4 id="8-4-文章目录TOC">8.4 文章目录TOC</h4><p>修改主题配置文件<code>_config.butterfly.yml</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">post:</span> <span class="literal">true</span> <span class="comment"># 文章页是否显示 TOC</span></span><br><span class="line">  <span class="attr">page:</span> <span class="literal">false</span> <span class="comment"># 普通页面是否显示 TOC</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span> <span class="comment"># 是否显示章节数</span></span><br><span class="line">  <span class="attr">expand:</span> <span class="literal">false</span><span class="comment"># 是否展开 TOC</span></span><br><span class="line">  <span class="attr">style_simple:</span> <span class="literal">false</span> <span class="comment"># for post 简洁模式（侧边栏只显示 TOC, 只对文章页有效 ）</span></span><br></pre></td></tr></table></figure><h4 id="8-5-相关文章推荐">8.5 相关文章推荐</h4><p>相关文章推荐的原理是根据文章tags的比重来推荐，修改主题配置文件<code>_config.butterfly.yml</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">related_post:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">6</span> <span class="comment"># 显示推荐文章数目</span></span><br><span class="line">  <span class="attr">date_type:</span> <span class="string">created</span> <span class="comment"># or created or updated 文章日期显示创建日或者更新日</span></span><br></pre></td></tr></table></figure><h4 id="8-6-文章锚点">8.6 文章锚点</h4><p>开启文章锚点后，当你在文章页进行滚动时，文章链接会根据标题ID进行替换。</p><p>注意: 每替换一次，会留下一个历史记录。所以如果一篇文章有很多锚点的话，网页的历史记录会很多。</p><p>修改主题配置文件<code>_config.butterfly.yml</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># anchor</span></span><br><span class="line"><span class="comment"># when you scroll in post , the url will update according to header id.</span></span><br><span class="line"><span class="attr">anchor:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="8-7-文章过期提醒">8.7 文章过期提醒</h4><p>可设置是否显示文章过期提醒，以更新时间为基准。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Displays outdated notice for a post (文章过期提醒)</span></span><br><span class="line"><span class="attr">noticeOutdate:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">flat</span> <span class="comment"># style: simple/flat</span></span><br><span class="line">  <span class="attr">limit_day:</span> <span class="number">365</span> <span class="comment"># 距离更新时间多少天才显示文章过期提醒</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">top</span> <span class="comment"># position: top/bottom</span></span><br><span class="line">  <span class="attr">message_prev:</span> <span class="string">It</span> <span class="string">has</span> <span class="string">been</span> <span class="comment"># 天数之前的文字</span></span><br><span class="line">  <span class="attr">message_next:</span> <span class="string">days</span> <span class="string">since</span> <span class="string">the</span> <span class="string">last</span> <span class="string">update,</span> <span class="string">the</span> <span class="string">content</span> <span class="string">of</span> <span class="string">the</span> <span class="string">article</span> <span class="string">may</span> <span class="string">be</span> <span class="string">outdated.</span> <span class="comment"># 天数之后的文字</span></span><br></pre></td></tr></table></figure><h4 id="8-8-文章分页按钮">8.8 文章分页按钮</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># post_pagination (分页)</span></span><br><span class="line"><span class="comment"># value: 1 || 2 || false# false:为关闭分页按钮；1:下一篇显示的是旧文章；2:下一篇显示的是新文章</span></span><br><span class="line"><span class="comment"># 1: The &#x27;next post&#x27; will link to old post</span></span><br><span class="line"><span class="comment"># 2: The &#x27;next post&#x27; will link to new post</span></span><br><span class="line"><span class="comment"># false: disable pagination</span></span><br><span class="line"><span class="attr">post_pagination:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="9-头像">9 头像</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">img:</span> <span class="string">/assets/head.jpg</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">false</span> <span class="comment"># true则会一直转圈</span></span><br></pre></td></tr></table></figure><h3 id="10-字数统计">10 字数统计</h3><ol><li>安装插件：在博客根目录，打开cmd命令窗口执行<code>npm install hexo-wordcount --save</code>。</li><li>开启配置：修改主题配置文件<code>_config.butterfly.yml</code>中的<code>wordcount</code>。</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wordcount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="11-本地搜索系统">11 本地搜索系统</h3><ol><li><p>安装依赖：前往博客根目录，打开cmd命令窗口执行<code>npm install hexo-generator-search --save</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure></li><li><p>注入配置：修改站点配置文件<code>_config.yml</code>，添加如下代码：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">content:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>主题中开启搜索：在主题配置文件<code>_config.butterfly.yml</code>中修改以下内容：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol><p>然后重新编译运行即可</p><h3 id="12-文章内容复制配置">12 文章内容复制配置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># copy settings</span></span><br><span class="line"><span class="comment"># copyright: Add the copyright information after copied content (复制的内容后面加上版权信息)</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span><span class="comment"># 是否开启网站复制权限</span></span><br><span class="line">  <span class="attr">copyright:</span><span class="comment"># 复制的内容后面加上版权信息</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span><span class="comment"># 是否开启复制版权信息添加</span></span><br><span class="line">    <span class="attr">limit_count:</span> <span class="number">50</span><span class="comment"># 字数限制，当复制文字大于这个字数限制时，将在复制的内容后面加上版权信息</span></span><br></pre></td></tr></table></figure><h3 id="13-Fotter设置">13 Fotter设置</h3><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">since:</span> <span class="number">2022</span><span class="comment"># 站点起始时间</span></span><br><span class="line">  <span class="attr">custom_text:</span><span class="comment"># 是一个给你用来在页脚自定义文本的选项。通常你可以在这里写声明文本等,支持 HTML。</span></span><br><span class="line">  <span class="attr">copyright:</span> <span class="literal">false</span> <span class="comment"># Copyright of theme and framework</span></span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_text:</span> <span class="string">I</span> <span class="string">wish</span> <span class="string">you</span> <span class="string">to</span> <span class="string">become</span> <span class="string">your</span> <span class="string">own</span> <span class="string">sun,</span> <span class="literal">no</span> <span class="string">need</span> <span class="string">to</span> <span class="string">rely</span> <span class="string">on</span> <span class="string">who&#x27;s</span> <span class="string">light.&lt;p&gt;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;https://hexo.io/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo&quot;</span> <span class="string">title=&quot;博客框架为Hexo&quot;&gt;&lt;/a&gt;&amp;nbsp;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;https://butterfly.js.org/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender&quot;</span> <span class="string">title=&quot;主题采用butterfly&quot;&gt;&lt;/a&gt;&amp;nbsp;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;https://www.jsdelivr.com/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr&quot;</span> <span class="string">title=&quot;本站使用JsDelivr为静态资源提供CDN加速&quot;&gt;&lt;/a&gt;</span> <span class="string">&amp;nbsp;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;https://vercel.com/</span> <span class="string">&quot;&gt;&lt;img src=&quot;</span><span class="string">https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&amp;logo=Vercel&quot;</span> <span class="string">title=&quot;本站采用双线部署，默认线路托管于Vercel&quot;&gt;&lt;/a&gt;&amp;nbsp;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;https://vercel.com/</span> <span class="string">&quot;&gt;&lt;img src=&quot;</span><span class="string">https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio&quot;</span> <span class="string">title=&quot;本站采用双线部署，联通线路托管于Coding&quot;&gt;&lt;/a&gt;&amp;nbsp;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;https://github.com/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub&quot;</span> <span class="string">title=&quot;本站项目由Gtihub托管&quot;&gt;&lt;/a&gt;&amp;nbsp;&lt;a</span> <span class="string">target=&quot;_blank&quot;</span> <span class="string">href=&quot;http://creativecommons.org/licenses/by-nc-sa/4.0/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris&quot;</span> <span class="string">title=&quot;本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可&quot;&gt;&lt;/a&gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure><p>对于部分人需要写 ICP 的，也可以写在custom_text里。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_text:</span> <span class="string">&lt;a</span> <span class="string">href=&quot;icp链接&quot;&gt;&lt;img</span> <span class="string">class=&quot;icp-icon&quot;</span> <span class="string">src=&quot;icp图片&quot;&gt;&lt;span&gt;备案号：xxxxxx&lt;/span&gt;&lt;/a&gt;</span></span><br></pre></td></tr></table></figure><h3 id="14-右下角按钮">14 右下角按钮</h3><h4 id="14-1-繁简转换">14.1 繁简转换</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">translate:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 默认按钮显示文字(网站是简体，应设置为&#x27;default: 繁&#x27;)</span></span><br><span class="line">  <span class="attr">default:</span> <span class="string">繁</span></span><br><span class="line">  <span class="comment"># the language of website (1 - Traditional Chinese/ 2 - Simplified Chinese）</span></span><br><span class="line">  <span class="comment"># 网站默认语言，1: 繁体中文, 2: 简体中文</span></span><br><span class="line">  <span class="attr">defaultEncoding:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># Time delay 延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0</span></span><br><span class="line">  <span class="attr">translateDelay:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment"># 当文字是简体时，按钮显示的文字</span></span><br><span class="line">  <span class="attr">msgToTraditionalChinese:</span> <span class="string">&#x27;繁&#x27;</span></span><br><span class="line">  <span class="comment"># 当文字是繁体时，按钮显示的文字</span></span><br><span class="line">  <span class="attr">msgToSimplifiedChinese:</span> <span class="string">&#x27;簡&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="14-2-夜间模式">14.2 夜间模式</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dark mode</span></span><br><span class="line"><span class="attr">darkmode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># dark 和 light 两种模式切换按钮</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Switch dark/light mode automatically (自動切換 dark mode和 light mode)</span></span><br><span class="line">  <span class="comment"># autoChangeMode: 1  Following System Settings, if the system doesn&#x27;t support dark mode, it will switch dark mode between 6 pm to 6 am</span></span><br><span class="line">  <span class="comment"># autoChangeMode: 2  Switch dark mode between 6 pm to 6 am</span></span><br><span class="line">  <span class="comment"># autoChangeMode: false</span></span><br><span class="line">  <span class="attr">autoChangeMode:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>v2.0.0 开始增加一个选项，可开启自动切换light mode 和 dark mode。</p><ul><li><code>autoChangeMode: 1</code> 跟随系统而变化，不支持的浏览器/系统将按照时间晚上6点到早上6点之间切换为 dark mode。</li><li><code>autoChangeMode: 2</code>只按照时间 晚上6点到早上6点之间切换为 dark mode,其余时间为light mode。</li><li><code>autoChangeMode: false</code> 取消自动切换。</li></ul><h4 id="14-3-阅读模式">14.3 阅读模式</h4><p>阅读模式下会去掉除文章外的内容，避免干扰阅读。只会出现在文章页面，右下角会有阅读模式按钮。</p><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readmode:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="15-侧边栏设置">15 侧边栏设置</h3><h4 id="15-1-排版">15.1 排版</h4><p>可自行决定哪个项目需要显示，可决定位置，也可以设置不显示侧边栏。</p><p>修改主题配置文件<code>_config.butterfly.yml</code>，下面例子可以参考</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aside:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># display on mobile</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">right</span> <span class="comment"># left or right</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">archive:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">category:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">card_author:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">    <span class="attr">button:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="comment"># fab fa-github</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">🛴前往小家...</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://github.com/fomalhaut1998</span></span><br><span class="line">  <span class="attr">card_announcement:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">&lt;center&gt;主域名：&lt;br&gt;&lt;a</span> <span class="string">href=&quot;https://www.fomal.cc&quot;&gt;&lt;b&gt;&lt;font</span> <span class="string">color=&quot;#5ea6e5&quot;&gt;fomal.cc&lt;/font&gt;&lt;/b&gt;&lt;/a&gt;&amp;nbsp;|&amp;nbsp;&lt;a</span> <span class="string">href=&quot;https://www.fomal.cn&quot;&gt;&lt;b&gt;&lt;font</span> <span class="string">color=&quot;#5ea6e5&quot;&gt;fomal.cn&lt;/font&gt;&lt;/b&gt;&lt;/a&gt;&lt;br&gt;备用域名：&lt;br&gt;&lt;a</span> <span class="string">href=&quot;https://blog.fomal.cc&quot;&gt;&lt;b&gt;&lt;font</span> <span class="string">color=&quot;#5ea6e5&quot;&gt;blog.fomal.cc&lt;/font&gt;&lt;/b&gt;&lt;/a&gt;&lt;br&gt;&lt;a</span> <span class="string">href=&quot;https://aa.fomal.cc&quot;&gt;&lt;b&gt;&lt;font</span> <span class="string">color=&quot;#5ea6e5&quot;&gt;aa.fomal.cc&lt;/font&gt;&lt;/b&gt;&lt;/a&gt;&lt;br&gt;&lt;a</span> <span class="string">href=&quot;https://bb.fomal.cc&quot;&gt;&lt;b&gt;&lt;font</span> <span class="string">color=&quot;#5ea6e5&quot;&gt;bb.fomal.cc&lt;/font&gt;&lt;/b&gt;&lt;/a&gt;&lt;br&gt;&lt;a</span> <span class="string">href=&quot;mailto:admin@fomal.cn&quot;&gt;📬：&lt;b&gt;&lt;font</span> <span class="string">color=&quot;#a591e0&quot;&gt;admin@fomal.cn&lt;/font&gt;&lt;/b&gt;&lt;/a&gt;&lt;/center&gt;</span></span><br><span class="line">  <span class="attr">card_recent_post:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">3</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort:</span> <span class="string">date</span> <span class="comment"># date or updated</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_categories:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">expand:</span> <span class="string">none</span> <span class="comment"># none/true/false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_tags:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">20</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">color:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_archives:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">monthly</span> <span class="comment"># yearly or monthly</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">MMMM</span> <span class="string">YYYY</span> <span class="comment"># eg: YYYY年MM月</span></span><br><span class="line">    <span class="attr">order:</span> <span class="number">-1</span> <span class="comment"># Sort of order. 1, asc for ascending; -1, desc for descending</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_webinfo:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">post_count:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">last_push_date:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_weibo:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="15-2-访问人数">15.2 访问人数</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">true</span>  <span class="comment"># 本站总访客数</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">true</span>  <span class="comment"># 本站总访问量 </span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">true</span>  <span class="comment"># 本文总阅读量</span></span><br></pre></td></tr></table></figure><h4 id="15-3-运行时间">15.3 运行时间</h4><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Time difference between publish date and now (網頁運行時間)</span></span><br><span class="line"><span class="comment">#Formal: Month/Day/Year Time or Year/Month/Day Time</span></span><br><span class="line"><span class="attr">runtimeshow:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">publish_date:</span> <span class="number">8</span><span class="string">/9/2022</span> <span class="number">00</span><span class="string">:00:00</span></span><br><span class="line">  <span class="comment">##网页开通时间</span></span><br><span class="line">  <span class="comment">#格式: 月/日/年 时间</span></span><br><span class="line">  <span class="comment">#也可以写成 年/月/日 时间</span></span><br></pre></td></tr></table></figure><h4 id="15-4-最新评论">15.4 最新评论</h4><p>最新评论只会在刷新时才会去读取，并不会实时变化。<br>由于 API 有 访问次数限制，为了避免调用太多，主题默认存取期限为 10 分鐘。也就是説，调用后资料会存在 <code>localStorage</code> 里，10分鐘内刷新网站只会去 <code>localStorage</code> 读取资料。 10 分鐘期限一过，刷新页面时才会去调取 API 读取新的数据。（3.6.0 新增了 storage 配置，可自行配置缓存时间）。</p><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Aside widget - Newest Comments</span></span><br><span class="line"><span class="attr">newest_comments:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">6</span>  <span class="comment"># 显示的数量</span></span><br><span class="line">  <span class="attr">storage:</span> <span class="number">10</span> <span class="comment"># 设置缓存时间，单位 分钟 </span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="literal">true</span> <span class="comment"># 是否显示头像</span></span><br></pre></td></tr></table></figure><h3 id="16-网站背景">16 网站背景</h3><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图片格式 url(http://xxxxxx.com/xxx.jpg)</span></span><br><span class="line"><span class="comment"># 颜色（HEX值/RGB值/颜色单词/渐变色)</span></span><br><span class="line"><span class="comment"># 留空 不显示背景</span></span><br><span class="line"><span class="attr">background:</span> <span class="string">url(https://source.fomal.cc/img/dm1.webp)</span></span><br></pre></td></tr></table></figure><p>如果你的网站根目录不是<code>'/'</code>，使用本地图片时，需加上你的根目录。<br>例如：网站是 <code>https://yoursite.com/blog</code>，引用一张<code>img/xx.png</code>图片，则设置<code>background</code>为 <code>url(/blog/img/xx.png)</code></p><h3 id="17-打字效果">17 打字效果</h3><p>详见：<a href="https://github.com/disjukr/activate-power-mode">activate-power-mode</a></p><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Typewriter Effect (打字效果)</span></span><br><span class="line"><span class="comment"># https://github.com/disjukr/activate-power-mode</span></span><br><span class="line"><span class="attr">activate_power_mode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">colorful:</span> <span class="literal">true</span> <span class="comment"># open particle animation (冒光特效)</span></span><br><span class="line">  <span class="attr">shake:</span> <span class="literal">true</span> <span class="comment">#  open shake (抖動特效)</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="18-footer背景">18 footer背景</h3><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># footer是否显示图片背景(与top_img一致)</span></span><br><span class="line"><span class="attr">footer_bg:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li><code>留空/false</code>：显示默认的颜色</li><li><code>图片链接</code>：显示所配置的图片</li><li><code>颜色包括HEX值 - #0000FF | RGB值 - rgb(0,0,255) | 颜色单词 - orange | 渐变色 - linear-gradient( 135deg, #E2B0FF 10%, #9F44D3 100%)</code>：对应的颜色</li><li><code>true</code>：显示跟 top_img 一样</li></ul><h3 id="19-背景特效">19 背景特效</h3><p>可设置每次刷新更换彩带，或者每次点击更换彩带。详细配置可查看<a href="https://github.com/hustcc/ribbon.js">canvas_ribbon</a></p><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">canvas_ribbon:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">150</span></span><br><span class="line">  <span class="attr">alpha:</span> <span class="number">0.6</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">click_to_change:</span> <span class="literal">false</span>  <span class="comment">#設置是否每次點擊都更換彩带</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment"># false 手機端不顯示 true 手機端顯示</span></span><br></pre></td></tr></table></figure><h3 id="20-鼠标点击效果">20 鼠标点击效果</h3><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 点击出現爱心</span></span><br><span class="line"><span class="attr">click_heart:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="21-自定义字体和字体大小">21 自定义字体和字体大小</h3><h4 id="21-1-全局字体">21.1 全局字体</h4><p>修改主题配置文件<code>_config.butterfly.yml</code>中的<code>font-family</code>属性即可，如不需要配置，请留空。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global font settings</span></span><br><span class="line"><span class="comment"># Don&#x27;t modify the following settings unless you know how they work (非必要不要修改)</span></span><br><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="attr">global-font-size:</span> <span class="string">&#x27;15px&#x27;</span></span><br><span class="line">  <span class="attr">code-font-size:</span> <span class="string">&#x27;14px&#x27;</span></span><br><span class="line">  <span class="comment"># -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot; , &quot;Helvetica Neue&quot; , Lato, Roboto, &quot;PingFang SC&quot; , &quot;Microsoft JhengHei&quot; , &quot;Microsoft YaHei&quot; , sans-serif</span></span><br><span class="line">  <span class="comment"># Wenkai, consolas, -apple-system, &#x27;Quicksand&#x27;, &#x27;Nimbus Roman No9 L&#x27;, &#x27;PingFang SC&#x27;, &#x27;Hiragino Sans GB&#x27;, &#x27;Noto Serif SC&#x27;, &#x27;Microsoft Yahei&#x27;, &#x27;WenQuanYi Micro Hei&#x27;, &#x27;ST Heiti&#x27;, sans-serif;</span></span><br><span class="line">  <span class="attr">font-family:</span> <span class="string">var(--global-font),</span> <span class="string">Consolas_1,</span> <span class="string">-apple-system,</span> <span class="string">&#x27;Quicksand&#x27;</span><span class="string">,</span> <span class="string">&#x27;Nimbus Roman No9 L&#x27;</span><span class="string">,</span> <span class="string">&#x27;PingFang SC&#x27;</span><span class="string">,</span> <span class="string">&#x27;Hiragino Sans GB&#x27;</span><span class="string">,</span> <span class="string">&#x27;Noto Serif SC&#x27;</span><span class="string">,</span> <span class="string">&#x27;Microsoft Yahei&#x27;</span><span class="string">,</span> <span class="string">&#x27;WenQuanYi Micro Hei&#x27;</span><span class="string">,</span> <span class="string">&#x27;ST Heiti&#x27;</span><span class="string">,</span> <span class="string">sans-serif;</span></span><br><span class="line">  <span class="comment"># consolas, ZhuZiAWan_light, &quot;Microsoft YaHei&quot;, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft JhengHei&quot;, sans-serif</span></span><br><span class="line">  <span class="comment"># Consolas_1, ZhuZiAWan_light, &quot;Microsoft YaHei&quot;, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft JhengHei&quot;, sans-serif</span></span><br><span class="line">  <span class="attr">code-font-family:</span> <span class="string">Consolas_1,</span> <span class="string">var(--global-font),</span> <span class="string">&quot;Microsoft YaHei&quot;</span><span class="string">,</span> <span class="string">Menlo,</span> <span class="string">&quot;PingFang SC&quot;</span><span class="string">,</span> <span class="string">&quot;Microsoft JhengHei&quot;</span></span><br></pre></td></tr></table></figure><h4 id="21-2-Blog标题字体">21.2 Blog标题字体</h4><p>修改主题配置文件<code>_config.butterfly.yml</code>中的<code>blog_title_font</code>属性即可，如不需要配置，请留空。<br>如不需要使用网络字体，只需要把font_link留空就行。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Font settings for the site title and site subtitle</span></span><br><span class="line"><span class="comment"># https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap</span></span><br><span class="line"><span class="comment"># Titillium Web, &#x27;PingFang SC&#x27; , &#x27;Hiragino Sans GB&#x27; , &#x27;Microsoft JhengHei&#x27; , &#x27;Microsoft YaHei&#x27; , sans-serif</span></span><br><span class="line"><span class="comment"># 左上角網站名字 主頁居中網站名字</span></span><br><span class="line"><span class="attr">blog_title_font:</span></span><br><span class="line">  <span class="attr">font_link:</span> </span><br><span class="line">  <span class="attr">font-family:</span> <span class="string">var(--global-font)</span></span><br></pre></td></tr></table></figure><h3 id="22-网站副标题">22 网站副标题</h3><p>可设置主页中显示的网站副标题或者喜欢的座右铭。</p><p>修改主题配置文件<code>_config.butterfly.yml</code>中的<code>subtitle</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the subtitle on homepage (主頁subtitle)</span></span><br><span class="line"><span class="attr">subtitle:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Typewriter Effect (打字效果)</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># loop (循環打字)</span></span><br><span class="line">  <span class="attr">loop:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># source 調用第三方服務</span></span><br><span class="line">  <span class="comment"># source: false 關閉調用</span></span><br><span class="line">  <span class="comment"># source: 1  調用一言網的一句話（簡體） https://hitokoto.cn/</span></span><br><span class="line">  <span class="comment"># source: 2  調用一句網（簡體） http://yijuzhan.com/</span></span><br><span class="line">  <span class="comment"># source: 3  調用今日詩詞（簡體） https://www.jinrishici.com/</span></span><br><span class="line">  <span class="comment"># subtitle 會先顯示 source , 再顯示 sub 的內容</span></span><br><span class="line">  <span class="attr">source:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 如果關閉打字效果，subtitle 只會顯示 sub 的第一行文字</span></span><br><span class="line">  <span class="attr">sub:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;Welcome to Fomalhaut🥝のTiny Home!🤣🤣🤣&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;Hope you have a nice day!🍭🍭🍭&quot;</span></span><br></pre></td></tr></table></figure><h3 id="23-页面加载动画">23 页面加载动画</h3><p>当进入网页时，因为加载速度的问题，可能会导致top_img图片出现断层显示，或者网页加载不全而出现等待时间，开启preloader后，会显示加载动画，等页面加载完，加载动画会消失。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载动画 Loading Animation</span></span><br><span class="line"><span class="attr">preloader:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="24-图片大图查看模式">24 图片大图查看模式</h3><p>只能开启一个。<br>如果你并不想为某张图片添加大图查看模式，你可以使用 html 格式引用图片，并为图片添加 no-lightbox class 名，例如：<code>&lt;img src=&quot;xxxx.jpg&quot; class=&quot;no-lightbox&quot;&gt;</code>。</p><p>修改主题配置文件<code>_config.butterfly.yml</code>中<code>fancybox</code>属性</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fancybox http://fancyapps.com/fancybox/3/</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="25-Pjax">25 Pjax</h3><p>当用户点击链接，通过 <code>ajax</code> 更新页面需要变化的部分，然后使用 HTML5 的 <code>pushState</code> 修改浏览器的 URL 地址。这样可以不用重复加载相同的资源<code>（css/js）</code>， 从而提升网页的加载速度。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pjax [Beta]</span></span><br><span class="line"><span class="comment"># It may contain bugs and unstable, give feedback when you find the bugs.</span></span><br><span class="line"><span class="comment"># https://github.com/MoOx/pjax</span></span><br><span class="line"><span class="attr">pjax:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 对于一些第三方插件，有些并不支持 pjax 。</span></span><br><span class="line">  <span class="comment"># 你可以把网页加入到 exclude 里，这个网页会被 pjax 排除在外。</span></span><br><span class="line">  <span class="comment"># 点击该网页会重新加载网站。</span></span><br><span class="line">  <span class="attr">exclude:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">/music/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/no-pjax/</span></span><br></pre></td></tr></table></figure><p>注意：使用 pjax 后，一些自己DIY的js可能会无效，跳转页面时需要重新调用（例如朋友圈、说说等），具体请参考<a href="https://github.com/MoOx/pjax">Pjax文档</a>。</p><h3 id="26-Inject">26 Inject</h3><p>如想添加额外的 js/css/meta 等等东西，可以在 Inject 里添加，head(<code>&lt;/body&gt;</code>标签之前)， bottom(<code>&lt;/html&gt;</code>标签之前)。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="comment"># 插入代码到头部 &lt;/head&gt; 之前 和 底部 &lt;/body&gt; 之前</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">butteryfly的基本设置</summary>
    
    
    
    <category term="博客搭建" scheme="https://codegao.cc/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="butteryfly" scheme="https://codegao.cc/tags/butteryfly/"/>
    
  </entry>
  
  <entry>
    <title>博客搭建(三)_安装Butterfly主题</title>
    <link href="https://codegao.cc/posts/62ce6679.html"/>
    <id>https://codegao.cc/posts/62ce6679.html</id>
    <published>2023-01-03T05:30:00.000Z</published>
    <updated>2023-03-13T02:39:30.467Z</updated>
    
    <content type="html"><![CDATA[<h3 id="下载主题">下载主题</h3><p>使用npm方式安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-theme-butterfly</span><br></pre></td></tr></table></figure><blockquote><p>安装好后可以在博客文件夹根目录的node_modules下找到hexo-theme-butterfly文件夹，这就是我们butterfly的主题啦</p></blockquote><h3 id="主题应用">主题应用</h3><p>①在配置文件中使用bufttery主题<br>修改<code>_config.yml</code>文件中的theme选项</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(三)_安装Butterfly主题/1.png"/></div></div><p>②安装butterfly需要的渲染器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><p>③新建一个butterfly主题配置文件(不是必须)</p><p>将原有的配置文件复制一份并重命名为<code>_config.butterfly.yml</code><br>后续我们的直接改这个配置就可以了</p><p>④接着我们启动项目</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#先清理</span></span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#再构建</span></span></span><br><span class="line">hexo g</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#启动</span></span></span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>然后我们访问本地端口就可以看到主题已经修改好啦</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(三)_安装Butterfly主题/2.png"/></div></div><h3 id="主题使用">主题使用</h3><h4 id="1-新建文章">1.新建文章</h4><p>我们可以删除原来的HelloWorld文章<br>在博客根目录/source/_posts文件夹下我们可以删除、新建文章<br>新建文章只需要新建一个.md文件即可，推荐使用typora写文章</p><h4 id="2-添加文章头">2.添加文章头</h4><p>hexo博客是需要一个头信息来表示文章信息的</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title:文章标题</span><br><span class="line">date:创建日期</span><br><span class="line">updated:修改日期</span><br><span class="line">tags:标签</span><br><span class="line">categories:分类</span><br><span class="line">keywords:关键字</span><br><span class="line">description:描述</span><br><span class="line">top<span class="emphasis">_img:文章顶部图片</span></span><br><span class="line"><span class="emphasis">comments:文章缩略图(如果没有设置top_</span>img,文章页顶部将显示缩略图，可设为false/图片地址/留空)</span><br><span class="line">cover:显示文章评论模块(默认 true)</span><br><span class="line">toc:显示文章TOC(默认为设置中toc的enable配置)</span><br><span class="line">toc<span class="emphasis">_number:显示toc_</span>number(默认为设置中toc的number配置)</span><br><span class="line">toc<span class="emphasis">_style_</span>simple:显示 toc 简洁模式</span><br><span class="line">copyright:显示文章版权模块(默认为设置中post<span class="emphasis">_copyright的enable配置)</span></span><br><span class="line"><span class="emphasis">copyright_</span>author:文章版权模块的文章作者</span><br><span class="line">copyright<span class="emphasis">_author_</span>href:文章版权模块的文章作者链接</span><br><span class="line">copyright<span class="emphasis">_url:文章版权模块的文章连结链接</span></span><br><span class="line"><span class="emphasis">copyright_</span>info:文章版权模块的版权声明文字</span><br><span class="line">mathjax:显示mathjax(当设置mathjax的per<span class="emphasis">_page: false时，才需要配置，默认 false)</span></span><br><span class="line"><span class="emphasis">katex:显示katex(当设置katex的per_</span>page: false时，才需要配置，默认 false)</span><br><span class="line">aplayer:在需要的页面加载aplayer的js和css,请参考文章下面的音乐 配置</span><br><span class="line">highlight<span class="emphasis">_shrink:配置代码框是否展开(true/false)(默认为设置中highlight_</span>shrink的配置)</span><br><span class="line"><span class="section">aside:显示侧边栏 (默认 true)</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><p>一般只需要用到title、date、updated、tags、categories</p><h4 id="3-添加标签页">3.添加标签页</h4><p>①在博客根目录执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure><p>②执行完命令后会在/source/tags下生成index.md文件<br><a href="http://xn--index-088bl532a7u9a.md">③修改index.md</a>，添加<code>type: &quot;tags&quot;</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">title: tags</span><br><span class="line">date: 2022-12-30 11:07:03</span><br><span class="line">type: &quot;tags&quot;</span><br></pre></td></tr></table></figure><h4 id="4-添加友情链接">4.添加友情链接</h4><p>①在博客根目录下执行命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page link</span><br></pre></td></tr></table></figure><p>②执行完命令后会在/source/link下生成index.md文件<br>③修改这个index.md文件，添加<code>type: &quot;link&quot;</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: link</span><br><span class="line">date: 2022-12-30 11:16:08</span><br><span class="line"><span class="section">type: &quot;link&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><p>④在/source/_data下创建一个<code>link.yml</code>文件(如果没有<code>_data</code>文件夹，自己创建，并写入以下信息)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">class_name:</span> <span class="number">1</span><span class="string">.技术支持</span></span><br><span class="line">  <span class="attr">class_desc:</span> <span class="string">本网站的搭建由以下开源作者提供技术支持</span></span><br><span class="line">  <span class="attr">link_list:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hexo</span> </span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://hexo.io/zh-cn/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">快速、简单且强大的网志框架</span></span><br><span class="line">      <span class="attr">siteshot:</span> <span class="string">https://source.fomal.cc/siteshot/hexo.io.jpg</span></span><br><span class="line">      </span><br><span class="line"><span class="bullet">-</span> <span class="attr">class_name:</span> <span class="number">2</span><span class="string">.友情链接</span></span><br><span class="line">  <span class="attr">class_desc:</span> <span class="string">一些好朋友~~</span></span><br><span class="line">  <span class="attr">link_list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Fomalhaut🥝</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://fomal.cc/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">/assets/head.jpg</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">Future</span> <span class="string">is</span> <span class="string">now</span> <span class="string">🍭🍭🍭</span></span><br><span class="line">      <span class="attr">siteshot:</span> <span class="string">https://source.fomal.cc/siteshot/www.fomal.cn.jpg</span></span><br></pre></td></tr></table></figure><h4 id="5-插入图片">5.插入图片</h4><p>①配置文件修改<br>把<code>_config.yml</code>中的：<code>post_asset_folder</code>改为true<br>②安装插件<br><code>npm install https://github.com/CodeFalling/hexo-asset-image -- save</code><br>③生成文章<br>使用命令生成文章：<code>hexo new postName</code><br>生成好后会在/source/_posts文件夹下生成一个.md的文章和一个同名的文件夹用来存放图片<br>④添加文章的时候直接写文件夹/图片名就可以，例如<code>![](test/1.png)</code></p><p>⑤typora设置</p><p>在文件-&gt;偏好设置中，设置复制到指定路径</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(三)_安装Butterfly主题/image-20230104093324947.png"/></div></div><p>我们在typora复制图片时就会直接放到hexo生成的图片文件夹下啦</p>]]></content>
    
    
    <summary type="html">主题安装及基本配置</summary>
    
    
    
    <category term="博客搭建" scheme="https://codegao.cc/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="butteryfly" scheme="https://codegao.cc/tags/butteryfly/"/>
    
  </entry>
  
  <entry>
    <title>博客搭建(二)_Vercel部署</title>
    <link href="https://codegao.cc/posts/7682ebb9.html"/>
    <id>https://codegao.cc/posts/7682ebb9.html</id>
    <published>2022-12-31T01:30:00.000Z</published>
    <updated>2023-03-13T02:31:53.017Z</updated>
    
    <content type="html"><![CDATA[<h3 id="部署到Vercel">部署到Vercel</h3><p>接下来我们把项目部署到Vercel</p><blockquote><p>Vercel简介：<a href="https://vercel.com/">vercel</a>是一个代码托管平台，它能够托管你的静态html界面，甚至能够托管你的node.js与Python服务端脚本，是不想买服务器的懒人的福音！</p></blockquote><p>①首先登陆官网，关联github账户</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/1.png"/></div></div><p>②选择Add New下面的Project</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/2.png"/></div></div><p>③然后导入我们部署到github的项目</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/3.png"/></div></div><p>④可以改个名字，然后部署</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/4.png"/></div></div><p>⑤这样就部署成功啦</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/5.png"/></div></div><h3 id="配置域名解析">配置域名解析</h3><p>①先打开Dashboard控制台</p><p>②再点击View Domain</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/6.png"/></div></div><p>②输入我们购买的域名并点击ADD</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/7.png"/></div></div><p>③需要我们配置一下域名解析</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/8.png"/></div></div><p>④在阿里云域名解析的菜单添加记录</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/image-20230105174025569.png"/></div></div><p>⑤把Vercel提供的三个值填入其中</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/9.png"/></div></div><p>⑥域名访问</p><p>等待Vercel校验完毕就可以访问了</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(二)_Vercel部署/11.png"/></div></div>]]></content>
    
    
    <summary type="html">部署到Vercel并配置域名解析</summary>
    
    
    
    <category term="博客搭建" scheme="https://codegao.cc/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="https://codegao.cc/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>博客搭建(一)_hexo博客搭建</title>
    <link href="https://codegao.cc/posts/62888507.html"/>
    <id>https://codegao.cc/posts/62888507.html</id>
    <published>2022-12-30T01:30:00.000Z</published>
    <updated>2023-03-13T02:23:52.304Z</updated>
    
    <content type="html"><![CDATA[<p>我按照我个人搭建博客的步骤，整理了这边文章<br>主要是在windwos上搭建的<br>部署到github pages上面，如果觉得github不方便，gitee也是可以的</p><h3 id="1-Node安装">1.Node安装</h3><h3 id="2-Hexo安装">2.Hexo安装</h3><p>node安装好后可以直接安装Hexo</p><p>打开cmd输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>安装好后可以<code>hexo -v</code>验证是否安装成功</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/1.png"/></div></div><h3 id="3-github注册并创建仓库">3.github注册并创建仓库</h3><p>github注册就不多说了，按照步骤注册就好<br>我们主要说一下创建仓库</p><p>①点击右上角的加号，New repostory就可以新建仓库了</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/2.png"/></div></div><p>②仓库设置</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/3.png"/></div></div><p>首先，如果要使用Github Pages服务的话，<strong>仓库名称必须是<code>用户名.github.io</code></strong></p><p>描述随便写一下就好</p><p>仓库权限一定要是公开的</p><p>可以添加一个README</p><h3 id="4-git安装">4.git安装</h3><p>官网：<a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a> ，下载最新版本即可</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/4.png"/></div></div><p>安装一路Next即可<br>安装好后，单击鼠标右键就可以看到两个git的程序了</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/5.png"/></div></div><p>我们点击Git Bash<br>输入<code>git --version</code>就可以查看git版本了</p><p>后面我们执行命令都可以使用git bash</p><p>我们还可以配置git用户信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;你的用户名&quot;</span><br><span class="line">git config --global user.email &quot;你的邮箱&quot;</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/6.png"/></div></div><h3 id="5-初始化Hexo项目">5.初始化Hexo项目</h3><p>①初始化hexo<br>选择一个空文件夹，然后执行初始化命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init blogTest(项目名)</span><br></pre></td></tr></table></figure><p>②进入刚刚创建的文件夹，安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd blogTest  //进入blogTest文件夹</span><br><span class="line">npm i</span><br></pre></td></tr></table></figure><p>安装好后，目录结构是这样的：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/7.png"/></div></div><p>【node_modules】：依赖包<br>【scaffolds】：生成文章的一些模板<br>【source】：用来存放你的文章<br>【themes】：主题<br>【.npmignore】：发布时忽略的文件（可忽略）<br>【_config.landscape.yml】：主题的配置文件<br>【config.yml】：博客的配置文件<br>【package.json】：项目名称、描述、版本、运行和开发等信息</p><p>③本地启动</p><p>输入<code>hexo s</code>命令，打开浏览器输入http://localhost:4000/ 即可在本地查看hexo的博客啦！</p><h3 id="6-部署到Github-Pages">6.部署到Github Pages</h3><p>①安装 hexo-deployer-git</p><p>在刚刚初始化的目录执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>②修改_config.yml 文件</p><p>config.ym是hexo的配置文件，最下面是部署的信息</p><p>将repository修改为自己的github项目地址即可</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:codeGao9807/codeGao9807.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><p>③修改好后我们将代码部署到Github</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure><ul><li>hexo clean：删除之前生成的文件，若未生成过静态文件，可忽略此命令。</li><li>hexo generate：生成静态文章，可以用<code>hexo g</code>缩写</li><li>hexo deploy：部署文章，可以用<code>hexo d</code>缩写</li></ul><p>如果出现<code>Deploy done</code>，则说明部署成功了。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/8.png"/></div></div><p>到github仓库上看一下我们的项目</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/9.png"/></div></div><p>如果出现黄色的小点，说明还没部署好</p><p>如果出现绿色的就可以访问了！</p><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/博客搭建(一)_hexo博客搭建/10.png"/></div></div>]]></content>
    
    
    <summary type="html">主要是环境安装，包括hexo安装、git安装等</summary>
    
    
    
    <category term="博客搭建" scheme="https://codegao.cc/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="https://codegao.cc/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令</title>
    <link href="https://codegao.cc/posts/82734d8.html"/>
    <id>https://codegao.cc/posts/82734d8.html</id>
    <published>2022-12-02T07:33:00.000Z</published>
    <updated>2023-05-31T08:43:14.606Z</updated>
    
    <content type="html"><![CDATA[<p>记录Linux中使用到的命令</p><h3 id="后台启动">后台启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh test.sh&amp;</span><br></pre></td></tr></table></figure><h3 id="打zip包">打zip包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r -q -o Django.zip /home/project/Django</span><br></pre></td></tr></table></figure><h3 id="查看网络数据传输">查看网络数据传输</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 host 103.254.76.103 -vvv -A -x</span><br></pre></td></tr></table></figure><h3 id="关闭网卡">关闭网卡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [NIC_NAME] down</span><br></pre></td></tr></table></figure><h3 id="设置主机名">设置主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hostname</span><br></pre></td></tr></table></figure><h3 id="设置主机名与ip映射">设置主机名与ip映射</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="W10-Warning-Changing-a-readonly-file">W10: Warning: Changing a <a href="https://so.csdn.net/so/search?q=readonly&amp;spm=1001.2101.3001.7020">readonly</a> file</h3><p>出现原因：</p><ol><li>文件被锁定；</li><li>当前角色只有读的权限；</li></ol><p>解决办法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+w 文件路径</span><br></pre></td></tr></table></figure><h3 id="无法创建目录：权限不够">无法创建目录：权限不够</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R 用户名 路径</span><br></pre></td></tr></table></figure><h3 id="防火墙">防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent    （--permanent永久生效，没有此参数重启后失效）</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=9111/tcp --permanent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新载入</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --query-port=80/tcp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭</span></span><br><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure><h3 id="显示文件行数">显示文件行数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set nu</span><br></pre></td></tr></table></figure><h3 id="查看端口信息">查看端口信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nltp</span><br></pre></td></tr></table></figure><h3 id="磁盘相关">磁盘相关</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看磁盘分区大小</span></span><br><span class="line">df -h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看根目录下文件夹大小</span></span><br><span class="line">cd / &amp;&amp; du -h -x --max-depth=1</span><br></pre></td></tr></table></figure><h3 id="软件安装">软件安装</h3><h4 id="1-telnet">1.telnet</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//先检查rpm包是否安装</span><br><span class="line">rpm -qa telnet-server</span><br><span class="line">//安装telnet-server</span><br><span class="line">yum install telnet-server</span><br><span class="line">//检测telnet的rpm包是否安装</span><br><span class="line">rpm -qa telnet</span><br><span class="line">//安装telnet</span><br><span class="line">yum install telnet</span><br></pre></td></tr></table></figure><h4 id="2-dos2unix">2.dos2unix</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install dos2unix*</span><br></pre></td></tr></table></figure><h4 id="3-expect">3.expect</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//先安装tcl</span><br><span class="line">//下载tcl安装包，https://sourceforge.net/projects/tcl/files/Tcl/8.6.12/tcl8.6.12-src.tar.gz/download</span><br><span class="line">tar -zxf tcl8.6.12-src.tar.gz</span><br><span class="line">cd tcl8.6.12/unix/</span><br><span class="line">./configure --prefix=/usr/tcl --enable-shared</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">目录tcl8.6.12/unix/下的tclUnixPort.h复制到generic中</span></span><br><span class="line">cp tclUnixPort.h ../generic/</span><br><span class="line">。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">授权允许普通用户使用</span></span><br><span class="line">chmod  755 /usr/tcl/lib/expect5.45.4</span><br><span class="line">chmod -R 755 /usr/tcl</span><br><span class="line"></span><br><span class="line">//安装expect</span><br><span class="line">//下载安装包：https://jaist.dl.sourceforge.net/project/expect/Expect/5.45.4/expect5.45.4.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxf expect5.45.4.tar.gz</span><br><span class="line">cd expect5.45.4</span><br><span class="line">./configure --prefix=/usr/expect --with-tcl=/usr/tcl/lib --with-tclinclude=../tcl8.6.12/generic##配置expect的安装路径，--with-tcl为告诉configure脚本tcl解释器位置，--with-tclinclude为告诉脚本tcl头文件位置</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /usr/tcl/bin/expect /usr/expect/bin/expect</span><br><span class="line"></span><br><span class="line">chmod -R 755 /usr/expect</span><br><span class="line">chmod 755 /usr/expect/bin</span><br><span class="line"></span><br><span class="line">//命令写入环境变量</span><br><span class="line">vi /etc/profile</span><br><span class="line">export PATH=$PATH:/usr/expect/bin/</span><br><span class="line"></span><br><span class="line">source  /etc/profile</span><br><span class="line"></span><br><span class="line">//测试</span><br><span class="line">输入expect命令，看是否进入形如expect1.1&gt;这样的命令行</span><br></pre></td></tr></table></figure><h4 id="4-安装mysql">4.安装mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//查看是否已经安装 Mysql</span><br><span class="line">rpm -qa | grep mysql</span><br><span class="line">//如果安装过可以执行命令删除</span><br><span class="line">rpm -e 文件名</span><br><span class="line">//下载官方 Mysql 包</span><br><span class="line">wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line">//安装包</span><br><span class="line">yum -y install mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line">//安装MySQL</span><br><span class="line">yum -y install mysql-community-server</span><br><span class="line">//如果安装失败提示密钥国企可以执行下面命令</span><br><span class="line"> rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br><span class="line">//启动服务</span><br><span class="line">systemctl start mysqld.service</span><br><span class="line">//查看 Mysql 运行状态</span><br><span class="line">service mysqld status</span><br><span class="line">//查看初始密码</span><br><span class="line">grep ‘password’ /var/log/mysqld.log</span><br><span class="line">//进入数据库</span><br><span class="line">mysql -u root -p</span><br><span class="line">//如果提示数据库无法访问，修改my.cnf</span><br><span class="line">//修改之前先关闭mysql服务</span><br><span class="line">service mysqld stop</span><br><span class="line">//修改 vi /etc/my.cnf</span><br><span class="line">//添加skip-grant-tables，这样mysql可以免密登录。</span><br><span class="line">//重启服务</span><br><span class="line">systemctl restart mysqld.service</span><br><span class="line">//切换mysql数据库</span><br><span class="line">show databases;</span><br><span class="line">use mysql;</span><br><span class="line">//重置密码root为root</span><br><span class="line">update user set authentication_string=password(&quot;root&quot;) where user=&quot;root&quot;;</span><br><span class="line">//删除skip-grant-tables</span><br><span class="line">//重启服务</span><br></pre></td></tr></table></figure><h4 id="5-安装Nginx">5.安装Nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//1.安装依赖包</span><br><span class="line">//一键安装上面四个依赖</span><br><span class="line">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel</span><br><span class="line"></span><br><span class="line">//2.下载并解压安装包</span><br><span class="line">//创建一个文件夹</span><br><span class="line">cd /usr/local</span><br><span class="line">mkdir nginx</span><br><span class="line">cd nginx</span><br><span class="line">//下载tar包</span><br><span class="line">wget http://nginx.org/download/nginx-1.13.7.tar.gz</span><br><span class="line">tar -xvf nginx-1.13.7.tar.gz</span><br><span class="line"></span><br><span class="line">//3.安装nginx</span><br><span class="line">//进入nginx目录</span><br><span class="line">cd /usr/local/nginx</span><br><span class="line">//进入目录</span><br><span class="line">cd nginx-1.13.7</span><br><span class="line">//执行命令 考虑到后续安装ssl证书 添加两个模块</span><br><span class="line">./configure --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">//执行make命令</span><br><span class="line">make</span><br><span class="line">//执行make install命令</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">//4.配置nginx.conf</span><br><span class="line">vi /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">//5.启动服务</span><br><span class="line">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">//6.重启nginx</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><h4 id="6-Hadoop单机安装">6.Hadoop单机安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir input</span><br><span class="line">cp etc/hadoop/*.xml input</span><br><span class="line">bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar grep input output &#x27;dfs[a-z.]+&#x27;</span><br><span class="line">cat output/*</span><br></pre></td></tr></table></figure><h4 id="7-Hive安装">7.Hive安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.解压压缩包</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.配置环境变量</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">HIVE</span></span><br><span class="line">export HIVE_HOME=/usr/local/hive</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.查看hive 版本</span></span><br><span class="line">hive --version</span><br></pre></td></tr></table></figure><h4 id="8-Spark安装">8.Spark安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.解压压缩包</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.配置环境变量</span></span><br><span class="line">export SPARK_HOME=/home/hadoop/spark</span><br><span class="line">export PATH=$SPARK_HOME/bin:$PATH:$SPARK_HOME:sbin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.在spark/conf目录下</span></span><br><span class="line">cp spark-env.sh.template spark-env.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4.在spark-env.sh里添加hadoop的路径</span></span><br><span class="line">export SPARK_DIST_CLASSPATH=$(/home/hadoop/hadoop/bin/hadoop classpath)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5.查看spark是否安装成功</span></span><br><span class="line">run-example SparkPi 2&gt;&amp;1 | grep &quot;Pi is&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6.使用spark shell</span></span><br><span class="line">spark shell</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">记录Linux使用过的命令</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="Linux" scheme="https://codegao.cc/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Nginx问题</title>
    <link href="https://codegao.cc/posts/dab7678.html"/>
    <id>https://codegao.cc/posts/dab7678.html</id>
    <published>2022-12-01T09:33:00.000Z</published>
    <updated>2023-03-13T07:41:12.652Z</updated>
    
    <content type="html"><![CDATA[<p>本文收集Nginx使用过程中遇到的问题</p><h3 id="常用命令">常用命令</h3><p>nginx的使用(启动、重启、关闭)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">利用配置文件启动nginx。</span></span><br><span class="line">nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启服务：</span> </span><br><span class="line">service nginx restart</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">快速停止或关闭</span></span><br><span class="line">Nginx：nginx -s stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">正常停止或关闭</span></span><br><span class="line">Nginx：nginx -s quit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置文件修改重装载命令</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="①查看Nginx配置文件位置">①查看Nginx配置文件位置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看安装位置</span></span></span><br><span class="line">ps -aux|grep nginx</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="/images/assets/Nginx/image-20230105103019170.png"/></div></div><p>然后根据安装位置测试配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#测试配置文件</span></span></span><br><span class="line">/usr/sbin/nginx -t</span><br></pre></td></tr></table></figure><p>就可以找到配置文件了</p>]]></content>
    
    
    <summary type="html">记录Nginx使用的命令及遇到的问题</summary>
    
    
    
    <category term="服务器" scheme="https://codegao.cc/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
    <category term="Nginx" scheme="https://codegao.cc/tags/Nginx/"/>
    
  </entry>
  
</feed>
